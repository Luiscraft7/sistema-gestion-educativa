<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - Sistema Educativo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Variables CSS Modernas */
        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-solid: #667eea;
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --danger: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --info: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            
            --bg-primary: rgba(15, 15, 35, 0.8);
            --bg-secondary: rgba(26, 26, 46, 0.8);
            --bg-tertiary: rgba(22, 33, 62, 0.8);
            --bg-card: rgba(255, 255, 255, 0.1);
            --bg-card-hover: rgba(255, 255, 255, 0.15);
            
            --text-primary: #ffffff;
            --text-secondary: #b8c5d1;
            --text-muted: #8b949e;
            
            --border: rgba(255, 255, 255, 0.15);
            --border-hover: rgba(255, 255, 255, 0.25);
            
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.3);
            
            --radius: 16px;
            --radius-sm: 8px;
            --radius-lg: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Header Moderno */
        .header {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title .icon {
            background: var(--primary);
            padding: 0.75rem;
            border-radius: var(--radius);
            font-size: 1.5rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-title h1 {
            font-size: 2rem;
            font-weight: 700;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0.75rem 1.5rem;
            background: var(--bg-card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Container Principal */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Estad√≠sticas Modernas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--border-hover);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
        }

        .stat-card.success::before { background: var(--success); }
        .stat-card.warning::before { background: var(--warning); }
        .stat-card.danger::before { background: var(--danger); }
        .stat-card.info::before { background: var(--info); }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-card.success .stat-icon { background: var(--success); }
        .stat-card.warning .stat-icon { background: var(--warning); }
        .stat-card.danger .stat-icon { background: var(--danger); }
        .stat-card.info .stat-icon { background: var(--info); }

        .stat-value {
            font-size: 3rem;
            font-weight: 800;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
        }

        .stat-change {
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        /* Navegaci√≥n Moderna */
        .tab-navigation {
            display: flex;
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 0.5rem;
            margin-bottom: 3rem;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            min-width: 200px;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            white-space: nowrap;
        }

        .tab-button:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow);
        }

        .tab-button i {
            font-size: 1.2rem;
        }

        /* Contenido de Tabs */
        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards Modernas */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .card-header {
            padding: 2rem;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-body {
            padding: 2rem;
        }

        /* Botones Modernos */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-info { background: var(--info); color: white; }
        .btn-secondary { background: var(--bg-tertiary); color: white; border: 1px solid var(--border); }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        /* Tabla Moderna */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background: var(--bg-card);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1.25rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr {
            transition: all 0.3s ease;
        }

        tr:hover {
            background: var(--bg-card-hover);
        }

        /* Badges y Estados */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.active {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .badge.inactive {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .badge.paid {
            background: rgba(33, 150, 243, 0.2);
            color: #2196F3;
            border: 1px solid rgba(33, 150, 243, 0.3);
        }

        .badge.unpaid {
            background: rgba(255, 152, 0, 0.2);
            color: #FF9800;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        /* Log de Actividad */
        .activity-log {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 1rem;
        }

        .log-entry {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
        }

        .log-entry:hover {
            background: var(--bg-card-hover);
            transform: translateX(5px);
        }

        .log-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .log-content {
            flex: 1;
        }

        .log-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 1rem;
        }

        .log-details {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .log-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: right;
        }

        /* Modal Moderno */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: var(--primary);
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        /* Loading */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid var(--primary-solid);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Controles generales */
        .payment-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .payment-controls .btn {
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .payment-controls .btn {
                min-width: 150px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .tab-navigation {
                padding: 0.25rem;
            }

            .tab-button {
                min-width: 120px;
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }

            .calendar-section,
            .payment-controls {
                flex-direction: column;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .admin-info {
                width: 100%;
                justify-content: center;
            }
        }

        /* Efectos de Scroll */
        .table-container {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-solid) var(--bg-tertiary);
        }

        .table-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: var(--primary-solid);
        }

        /* Animaciones adicionales */
        .card {
            animation: slideInUp 0.6s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-card {
            animation: fadeInScale 0.8s ease;
            animation-fill-mode: both;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Notificaciones Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
            z-index: 10001;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success { border-left: 4px solid #4CAF50; }
        .toast.error { border-left: 4px solid #f44336; }
        .toast.warning { border-left: 4px solid #FF9800; }
        .toast.info { border-left: 4px solid #2196F3; }

        /* Filtros avanzados */
        .filters-section {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .filter-input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.75rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary-solid);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* M√©tricas avanzadas */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 800;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .metric-trend {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        .metric-trend.up {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .metric-trend.down {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
    </style>
</head>
<body>
    <!-- Header Moderno -->
    <header class="header">
        <div class="header-content">
            <div class="header-title">
                <div class="icon">
                    <i class="fas fa-cogs"></i>
                </div>
                <h1>Panel de Administraci√≥n</h1>
            </div>
            <div class="header-actions">
                <div class="admin-info" id="admin-info">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>
        </div>
    </header>

    <!-- Container Principal -->
    <main class="container">
        <!-- Estad√≠sticas Principales -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-change">+5.2%</div>
                </div>
                <div class="stat-value" id="total-teachers">0</div>
                <div class="stat-label">Total Profesores</div>
            </div>
            
            <div class="stat-card success">
                <div class="stat-header">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-change">+12.8%</div>
                </div>
                <div class="stat-value" id="active-teachers">0</div>
                <div class="stat-label">Profesores Activos</div>
            </div>
            
            <div class="stat-card warning">
                <div class="stat-header">
                    <div class="stat-icon">
                        <i class="fas fa-school"></i>
                    </div>
                    <div class="stat-change">+8.1%</div>
                </div>
                <div class="stat-value" id="total-schools">0</div>
                <div class="stat-label">Escuelas Registradas</div>
            </div>
            
            <div class="stat-card info">
                <div class="stat-header">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-change">+15.3%</div>
                </div>
                <div class="stat-value" id="active-sessions">0</div>
                <div class="stat-label">Sesiones Activas</div>
            </div>
        </section>

        <!-- Navegaci√≥n por Tabs -->
        <nav class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('overview')">
                <i class="fas fa-chart-line"></i>
                Resumen General
            </button>
            <button class="tab-button" onclick="switchTab('teachers')">
                <i class="fas fa-users-cog"></i>
                Gesti√≥n Profesores
            </button>
            <button class="tab-button" onclick="switchTab('sessions')">
                <i class="fas fa-lock"></i>
                Control Sesiones
            </button>
            <button class="tab-button" onclick="switchTab('analytics')">
                <i class="fas fa-chart-bar"></i>
                Anal√≠ticas
            </button>
            <button class="tab-button" onclick="switchTab('activity')">
                <i class="fas fa-history"></i>
                Actividad
            </button>
        </nav>

        <!-- Tab: Resumen General -->
        <section id="overview-tab" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard General
                    </h3>
                    <button class="btn btn-primary" onclick="refreshOverview()">
                        <i class="fas fa-sync-alt"></i>
                        Actualizar
                    </button>
                </div>
                <div class="card-body">
                    <!-- M√©tricas Avanzadas -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="revenue-month">0</div>
                            <div class="metric-label">Profesores Registrados</div>
                            <div class="metric-trend up">‚Üó +15.3%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="avg-payment-time">5.2</div>
                            <div class="metric-label">Promedio de Escuelas por Profesor</div>
                            <div class="metric-trend up">‚Üó +0.3</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="active-schools">0</div>
                            <div class="metric-label">Escuelas Activas</div>
                            <div class="metric-trend up">‚Üó +3</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="system-uptime">99.9%</div>
                            <div class="metric-label">Disponibilidad del Sistema</div>
                            <div class="metric-trend up">‚Üó +0.1%</div>
                        </div>
                    </div>

                    <!-- Acciones R√°pidas -->
                    <div class="card">
                        <div class="card-header">
                            <h4><i class="fas fa-bolt"></i> Acciones R√°pidas</h4>
                        </div>
                        <div class="card-body">
                            <div class="payment-controls">
                                <button class="btn btn-success btn-lg" onclick="activateAllPendingTeachers()">
                                    <i class="fas fa-user-plus"></i>
                                    Activar Profesores Pendientes
                                </button>
                                <button class="btn btn-warning btn-lg" onclick="sendWelcomeEmails()">
                                    <i class="fas fa-envelope"></i>
                                    Enviar Emails de Bienvenida
                                </button>
                                <button class="btn btn-info btn-lg" onclick="generateSystemReport()">
                                    <i class="fas fa-file-alt"></i>
                                    Generar Reporte del Sistema
                                </button>
                                <button class="btn btn-secondary btn-lg" onclick="backupDatabase()">
                                    <i class="fas fa-database"></i>
                                    Respaldar Base de Datos
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab: Gesti√≥n de Profesores -->
        <section id="teachers-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-users-cog"></i>
                        Gesti√≥n de Profesores
                    </h3>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="refreshTeachers()">
                            <i class="fas fa-sync-alt"></i>
                            Actualizar
                        </button>
                        <button class="btn btn-success" onclick="exportTeachersData()">
                            <i class="fas fa-download"></i>
                            Exportar
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Filtros Avanzados -->
                    <div class="filters-section">
                        <h4><i class="fas fa-filter"></i> Filtros Avanzados</h4>
                        <div class="filters-grid">
                            <div class="filter-group">
                                <label class="filter-label">Estado</label>
                                <select class="filter-input" id="filter-status" onchange="applyFilters()">
                                    <option value="">Todos</option>
                                    <option value="active">Activos</option>
                                    <option value="inactive">Inactivos</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Pago</label>
                                <select class="filter-input" id="filter-payment" onchange="applyFilters()">
                                    <option value="">Todos</option>
                                    <option value="paid">Pagados</option>
                                    <option value="unpaid">Pendientes</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Regional</label>
                                <select class="filter-input" id="filter-regional" onchange="applyFilters()">
                                    <option value="">Todas</option>
                                    <!-- Se llena din√°micamente -->
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Buscar</label>
                                <input type="text" class="filter-input" id="filter-search" placeholder="Nombre, email, c√©dula..." onkeyup="applyFilters()">
                            </div>
                        </div>
                    </div>

                    <div id="teachers-table-container">
                        <!-- Tabla se carga din√°micamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab: Control de Sesiones -->
        <section id="sessions-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-lock"></i>
                        Control de Sesiones Activas
                    </h3>
                    <button class="btn btn-info" onclick="refreshSessions()">
                        <i class="fas fa-sync-alt"></i>
                        Actualizar Estado
                    </button>
                </div>
                <div class="card-body">
                    <div id="sessions-table-container">
                        <!-- Tabla de sesiones se carga din√°micamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab: Anal√≠ticas -->
        <section id="analytics-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-chart-bar"></i>
                        Anal√≠ticas del Sistema
                    </h3>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="refreshAnalytics()">
                            <i class="fas fa-sync-alt"></i>
                            Actualizar
                        </button>
                        <button class="btn btn-success" onclick="exportAnalytics()">
                            <i class="fas fa-download"></i>
                            Exportar
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="total-logins">0</div>
                            <div class="metric-label">Total de Logins</div>
                            <div class="metric-trend up">‚Üó +25.3%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="avg-session-time">0min</div>
                            <div class="metric-label">Tiempo Promedio de Sesi√≥n</div>
                            <div class="metric-trend up">‚Üó +5.2min</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="peak-hours">2-4pm</div>
                            <div class="metric-label">Horas Pico</div>
                            <div class="metric-trend">‚Üí Sin cambios</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="bounce-rate">12.3%</div>
                            <div class="metric-label">Tasa de Rebote</div>
                            <div class="metric-trend down">‚Üò -3.1%</div>
                        </div>
                    </div>
                    
                    <!-- Gr√°ficos placeholder -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                        <div class="card">
                            <div class="card-header">
                                <h4>Uso por D√≠a de la Semana</h4>
                            </div>
                            <div class="card-body" style="height: 300px; display: flex; align-items: center; justify-content: center; color: var(--text-muted);">
                                <i class="fas fa-chart-line" style="font-size: 3rem;"></i>
                                <span style="margin-left: 1rem;">Gr√°fico se implementar√°</span>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h4>Crecimiento de Usuarios</h4>
                            </div>
                            <div class="card-body" style="height: 300px; display: flex; align-items: center; justify-content: center; color: var(--text-muted);">
                                <i class="fas fa-chart-area" style="font-size: 3rem;"></i>
                                <span style="margin-left: 1rem;">Gr√°fico se implementar√°</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab: Log de Actividad -->
        <section id="activity-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-history"></i>
                        Log de Actividad del Sistema
                    </h3>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary" onclick="clearActivityLog()">
                            <i class="fas fa-trash"></i>
                            Limpiar Log
                        </button>
                        <button class="btn btn-info" onclick="exportActivityLog()">
                            <i class="fas fa-download"></i>
                            Exportar Log
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="activity-log" id="activity-log">
                        <!-- Log de actividad se carga din√°micamente -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Container -->
    <div id="modal-container" style="display: none;"></div>

    <script>
        // Variables globales
        let currentTeachersList = [];
        let teachers = [];
        let sessions = [];

        // Helper para peticiones autenticadas con token de administrador
        async function adminAuthenticatedFetch(url, options = {}) {
            const token = localStorage.getItem('adminToken');

            const defaultOptions = {
                headers: {
                    'Authorization': token ? `Bearer ${token}` : '',
                    'Content-Type': 'application/json'
                }
            };

            const mergedOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...(options.headers || {})
                }
            };

            const response = await fetch(url, mergedOptions);

            if (response.status === 401) {
                console.error('Token requerido para acceso de administrador');
                return Promise.reject(new Error('Unauthorized'));
            }

            return response;
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAuthentication();
            initializeAdmin();
        });

        // Verificar autenticaci√≥n administrativa
        function checkAdminAuthentication() {
            const adminSession = sessionStorage.getItem('adminSession');
            const adminUser = sessionStorage.getItem('adminUser');

            if (
                adminSession !== 'true' ||
                !adminUser
            ) {
                showToast('error', 'Acceso denegado. Redirigiendo al login administrativo...');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return false;
            }
            
            updateHeaderWithAdmin(adminUser);
            return true;
        }

        // Actualizar header con informaci√≥n del admin
        function updateHeaderWithAdmin(adminUser) {
            const adminInfo = document.getElementById('admin-info');
            adminInfo.innerHTML = `
                <div class="admin-avatar">${adminUser.charAt(0).toUpperCase()}</div>
                <div>
                    <div style="font-weight: 600;">${adminUser}</div>
                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Super Administrador</div>
                </div>
                <button class="btn btn-secondary btn-sm" onclick="logoutAdmin()">
                    <i class="fas fa-sign-out-alt"></i>
                    Salir
                </button>
            `;
        }

        // Inicializar panel de administrador
        async function initializeAdmin() {
            try {
                console.log('üöÄ Inicializando panel de administrador...');
                
                await updateStats();
                await loadTeachers();
                loadActivityLog();
                
                // Actualizaci√≥n autom√°tica cada 30 segundos
                setInterval(() => {
                    updateStats();
                }, 30000);
                
                // Mostrar notificaci√≥n de bienvenida
                showToast('success', '¬°Bienvenido al panel de administraci√≥n!');
                
                console.log('‚úÖ Panel de administrador inicializado correctamente');
                
            } catch (error) {
                console.error('‚ùå Error inicializando admin:', error);
                showToast('error', 'Error al inicializar el panel');
            }
        }

        // Inicializar calendario
        function initializeCalendar() {
            updateCalendar();
        }

        // Sistema de notificaciones toast
        function showToast(type, message, duration = 5000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <i class="fas fa-${getToastIcon(type)}"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer; margin-left: auto;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, duration);
        }

        function getToastIcon(type) {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        // ========================================
        // GESTI√ìN DE TABS
        // ========================================
        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            addActivityLog('navigation', 'Navegaci√≥n', `Cambi√≥ a la pesta√±a: ${tabName}`);
        }

        // ========================================
        // GESTI√ìN DE PROFESORES
        // ========================================
        async function loadTeachers() {
            try {
                console.log('üìã Cargando profesores...');
                
                const response = await adminAuthenticatedFetch('/api/teachers');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || 'Error cargando profesores');
                }
                
                teachers = data.data || [];
                console.log(`‚úÖ ${teachers.length} profesores cargados`);
                
                renderTeachersTable(teachers);
                populateRegionalFilter();
                
            } catch (error) {
                console.error('‚ùå Error cargando profesores:', error);
                const container = document.getElementById('teachers-table-container');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem; color: var(--danger);"></i>
                            <h4>Error cargando profesores</h4>
                            <p>${error.message}</p>
                            <button class="btn btn-primary" onclick="loadTeachers()">
                                <i class="fas fa-sync-alt"></i> Reintentar
                            </button>
                        </div>
                    `;
                }
                showToast('error', 'Error al cargar la lista de profesores');
            }
        }

        function renderTeachersTable(teachersData) {
            const container = document.getElementById('teachers-table-container');
            
            if (!container) {
                console.error('‚ùå Contenedor de tabla no encontrado');
                return;
            }
            
            if (!teachersData || teachersData.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                        <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h4>No hay profesores registrados</h4>
                        <p>Los profesores aparecer√°n aqu√≠ cuando se registren en el sistema.</p>
                    </div>
                `;
                return;
            }

            currentTeachersList = teachersData;
            
                            const tableHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 280px;"><i class="fas fa-user"></i> Informaci√≥n del Profesor</th>
                                <th style="width: 250px;"><i class="fas fa-school"></i> Escuelas Asignadas</th>
                                <th style="width: 200px;"><i class="fas fa-envelope"></i> Contacto</th>
                                <th style="width: 150px;"><i class="fas fa-map-marker-alt"></i> Regional</th>
                                <th style="width: 120px;"><i class="fas fa-toggle-on"></i> Estado</th>
                                <th style="width: 150px;"><i class="fas fa-clock"></i> √öltimo Acceso</th>
                                <th style="width: 150px;"><i class="fas fa-cogs"></i> Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${teachersData.map(teacher => {
                                const schoolsBadges = teacher.schools && teacher.schools.length > 0 
                                    ? teacher.schools.map(school => 
                                        `<div style="margin: 3px 0;">
                                            <span class="badge ${school.is_primary_school ? 'active' : 'inactive'}" style="font-size: 0.8rem; padding: 4px 8px;">
                                                ${school.is_primary_school ? 'üèÜ' : 'üè´'} ${school.school_name}
                                            </span>
                                        </div>`
                                    ).join('')
                                    : '<span style="color: var(--text-muted); font-style: italic;">Sin escuelas asignadas</span>';
                                
                                return `
                                    <tr style="height: 80px;">
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 1rem;">
                                                <div style="width: 50px; height: 50px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem; flex-shrink: 0;">
                                                    ${teacher.full_name.charAt(0).toUpperCase()}
                                                </div>
                                                <div style="flex: 1;">
                                                    <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 4px;">${teacher.full_name}</div>
                                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                                        <i class="fas fa-id-card" style="margin-right: 5px;"></i>
                                                        ${teacher.cedula}
                                                    </div>
                                                    ${teacher.teacher_type ? `<div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 2px;">${teacher.teacher_type}</div>` : ''}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div style="max-width: 100%;">
                                                ${schoolsBadges}
                                                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px; font-weight: 600;">
                                                    <i class="fas fa-building" style="margin-right: 3px;"></i>
                                                    ${teacher.schools_count || 0} escuela${(teacher.schools_count || 0) !== 1 ? 's' : ''}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div>
                                                <a href="mailto:${teacher.email}" style="color: var(--primary-solid); text-decoration: none; font-weight: 500; display: block; margin-bottom: 5px;">
                                                    <i class="fas fa-envelope" style="margin-right: 5px;"></i>
                                                    ${teacher.email}
                                                </a>
                                                ${teacher.specialized_type ? `<div style="font-size: 0.8rem; color: var(--info-solid); font-weight: 500;"><i class="fas fa-star" style="margin-right: 3px;"></i>${teacher.specialized_type}</div>` : ''}
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge" style="background: var(--info); font-size: 0.85rem; padding: 6px 10px;">
                                                <i class="fas fa-map-marked-alt" style="margin-right: 4px;"></i>
                                                ${teacher.regional || 'No especificada'}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge ${teacher.is_active ? 'active' : 'inactive'}" style="font-size: 0.85rem; padding: 6px 10px;">
                                                <i class="fas fa-${teacher.is_active ? 'check-circle' : 'clock'}"></i>
                                                ${teacher.is_active ? 'Activo' : 'Pendiente'}
                                            </span>
                                        </td>
                                        <td>
                                            <div style="font-size: 0.85rem; color: var(--text-secondary); text-align: center;">
                                                ${teacher.last_login ? `
                                                    <div style="font-weight: 600; margin-bottom: 2px;">
                                                        ${new Date(teacher.last_login).toLocaleDateString('es-ES')}
                                                    </div>
                                                    <div style="font-size: 0.75rem;">
                                                        ${new Date(teacher.last_login).toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}
                                                    </div>
                                                ` : '<div style="color: var(--text-muted); font-style: italic;">Nunca</div>'}
                                            </div>
                                        </td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem; justify-content: center;">
                                                <button class="btn btn-sm ${teacher.is_active ? 'btn-danger' : 'btn-success'}" 
                                                        onclick="toggleTeacherStatus(${teacher.id}, '${teacher.is_active ? 'deactivate' : 'activate'}')"
                                                        title="${teacher.is_active ? 'Desactivar' : 'Activar'} profesor">
                                                    <i class="fas fa-${teacher.is_active ? 'user-times' : 'user-check'}"></i>
                                                </button>
                                                <button class="btn btn-sm btn-info" 
                                                        onclick="viewTeacherDetails(${teacher.id})"
                                                        title="Ver detalles del profesor">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        function populateRegionalFilter() {
            const regionalSelect = document.getElementById('filter-regional');
            if (!regionalSelect) return;

            const regionals = [...new Set(teachers.map(t => t.regional).filter(r => r))];
            
            regionalSelect.innerHTML = '<option value="">Todas</option>' +
                regionals.map(r => `<option value="${r}">${r}</option>`).join('');
        }

        function applyFilters() {
            const statusFilter = document.getElementById('filter-status').value;
            const paymentFilter = document.getElementById('filter-payment').value;
            const regionalFilter = document.getElementById('filter-regional').value;
            const searchFilter = document.getElementById('filter-search').value.toLowerCase();

            let filteredTeachers = teachers.filter(teacher => {
                const matchesStatus = !statusFilter || 
                    (statusFilter === 'active' && teacher.is_active) ||
                    (statusFilter === 'inactive' && !teacher.is_active);
                
                const matchesPayment = !paymentFilter ||
                    (paymentFilter === 'paid' && teacher.is_paid) ||
                    (paymentFilter === 'unpaid' && !teacher.is_paid);
                
                const matchesRegional = !regionalFilter || teacher.regional === regionalFilter;
                
                const matchesSearch = !searchFilter ||
                    teacher.full_name.toLowerCase().includes(searchFilter) ||
                    teacher.email.toLowerCase().includes(searchFilter) ||
                    teacher.cedula.includes(searchFilter);

                return matchesStatus && matchesPayment && matchesRegional && matchesSearch;
            });

            renderTeachersTable(filteredTeachers);
        }

        async function toggleTeacherStatus(teacherId, action) {
            try {
                const response = await adminAuthenticatedFetch(`/api/teachers/${teacherId}/toggle-status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action })
                });

                const data = await response.json();
                if (data.success) {
                    await loadTeachers();
                    updateStats();
                    addActivityLog('status', 'Estado Cambiado', `Profesor ${action === 'activate' ? 'activado' : 'desactivado'}`);
                    showToast('success', `Profesor ${action === 'activate' ? 'activado' : 'desactivado'} correctamente`);
                }
            } catch (error) {
                console.error('Error cambiando estado:', error);
                showToast('error', 'Error al cambiar el estado del profesor');
            }
        }

        function viewTeacherDetails(teacherId) {
            const teacher = currentTeachersList.find(t => t.id === teacherId);
            
            if (!teacher) {
                showToast('error', 'Profesor no encontrado');
                return;
            }
            
            const modalHTML = `
                <div class="modal-overlay" onclick="closeTeacherDetails()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3><i class="fas fa-user"></i> Detalles del Profesor</h3>
                            <button class="close-btn" onclick="closeTeacherDetails()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div style="padding: 2rem;">
                            <div class="detail-section">
                                <h4><i class="fas fa-info-circle"></i> Informaci√≥n Personal</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); border-left: 4px solid var(--primary-solid);">
                                        <strong>Nombre:</strong><br>${teacher.full_name}
                                    </div>
                                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); border-left: 4px solid var(--primary-solid);">
                                        <strong>C√©dula:</strong><br>${teacher.cedula}
                                    </div>
                                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); border-left: 4px solid var(--primary-solid);">
                                        <strong>Email:</strong><br>${teacher.email}
                                    </div>
                                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); border-left: 4px solid var(--primary-solid);">
                                        <strong>Regional:</strong><br>${teacher.regional || 'No especificada'}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-section" style="margin-top: 2rem;">
                                <h4><i class="fas fa-school"></i> Escuelas Asignadas (${teacher.schools_count || 0})</h4>
                                <div style="margin-top: 1rem;">
                                    ${teacher.schools && teacher.schools.length > 0 
                                        ? teacher.schools.map(school => `
                                            <div style="background: ${school.is_primary_school ? 'rgba(76, 175, 80, 0.1)' : 'var(--bg-tertiary)'}; padding: 1rem; border-radius: var(--radius); margin-bottom: 0.5rem; border-left: 4px solid ${school.is_primary_school ? '#4CAF50' : 'var(--border)'};">
                                                <div style="font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                                                    ${school.is_primary_school ? 'üèÜ' : 'üè´'} ${school.school_name}
                                                    ${school.is_primary_school ? '<span style="background: #4CAF50; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.7rem;">Principal</span>' : ''}
                                                </div>
                                                ${school.address ? `<div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">üìç ${school.address}</div>` : ''}
                                                ${school.phone ? `<div style="font-size: 0.875rem; color: var(--text-secondary);">üìû ${school.phone}</div>` : ''}
                                            </div>
                                        `).join('')
                                        : '<p style="color: var(--text-muted);">Sin escuelas asignadas</p>'
                                    }
                                </div>
                            </div>
                            
                            <div class="detail-section" style="margin-top: 2rem;">
                                <h4><i class="fas fa-chart-line"></i> Estado de la Cuenta</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); border-left: 4px solid var(--info-solid);">
                                        <strong>Estado:</strong><br>
                                        <span class="badge ${teacher.is_active ? 'active' : 'inactive'}" style="margin-top: 0.5rem;">
                                            ${teacher.is_active ? '‚úÖ Activo' : '‚è≥ Pendiente'}
                                        </span>
                                    </div>
                                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); border-left: 4px solid var(--info-solid);">
                                        <strong>Pago:</strong><br>
                                        <span class="badge ${teacher.is_paid ? 'paid' : 'unpaid'}" style="margin-top: 0.5rem;">
                                            ${teacher.is_paid ? 'üí∞ Al d√≠a' : '‚è≥ Pendiente'}
                                        </span>
                                    </div>
                                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); border-left: 4px solid var(--info-solid);">
                                        <strong>Registro:</strong><br>${new Date(teacher.registration_date).toLocaleString('es-ES')}
                                    </div>
                                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius); border-left: 4px solid var(--info-solid);">
                                        <strong>√öltimo Login:</strong><br>${teacher.last_login ? new Date(teacher.last_login).toLocaleString('es-ES') : 'Nunca'}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="padding: 2rem; background: var(--bg-tertiary); display: flex; gap: 1rem; justify-content: flex-end; flex-wrap: wrap;">
                            <button class="btn ${teacher.is_active ? 'btn-danger' : 'btn-success'}" 
                                    onclick="toggleTeacherStatus(${teacher.id}, '${teacher.is_active ? 'deactivate' : 'activate'}'); closeTeacherDetails();">
                                <i class="fas fa-${teacher.is_active ? 'times' : 'check'}"></i>
                                ${teacher.is_active ? 'Desactivar' : 'Activar'}
                            </button>
                            <button class="btn btn-secondary" onclick="closeTeacherDetails()">
                                <i class="fas fa-times"></i>
                                Cerrar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const modalContainer = document.getElementById('modal-container') || createModalContainer();
            modalContainer.innerHTML = modalHTML;
            modalContainer.style.display = 'block';
        }

        function closeTeacherDetails() {
            const modalContainer = document.getElementById('modal-container');
            if (modalContainer) {
                modalContainer.style.display = 'none';
                modalContainer.innerHTML = '';
            }
        }

        function createModalContainer() {
            let container = document.getElementById('modal-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'modal-container';
                container.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; display: none;';
                document.body.appendChild(container);
            }
            return container;
        }

        async function refreshTeachers() {
            const button = event.target;
            const originalHTML = button.innerHTML;
            button.innerHTML = '<div class="loading-spinner"></div> Actualizando...';
            button.disabled = true;

            try {
                await loadTeachers();
                addActivityLog('refresh', 'Actualizaci√≥n', 'Lista de profesores actualizada');
                showToast('success', 'Lista de profesores actualizada');
            } finally {
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }, 1000);
            }
        }

        function exportTeachersData() {
            // Implementar exportaci√≥n de datos
            showToast('info', 'Funci√≥n de exportaci√≥n se implementar√° pr√≥ximamente');
            addActivityLog('export', 'Exportaci√≥n', 'Datos de profesores exportados');
        }

        // ========================================
        // GESTI√ìN DE PAGOS
        // ========================================
        function renderTeachersPaymentList() {
            const container = document.getElementById('teachers-payment-list');
            if (!container) return;
            
            if (!teachers || teachers.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No hay profesores para mostrar</p>';
                return;
            }
            
            const listHTML = teachers.map(teacher => `
                <div class="teacher-checkbox-item">
                    <input type="checkbox" 
                           class="teacher-checkbox" 
                           data-teacher-id="${teacher.id}"
                           ${teacher.is_paid ? 'disabled' : ''}
                           onchange="updatePaymentSummary()">
                    <div class="teacher-info">
                        <div class="teacher-name">${teacher.full_name}</div>
                        <div class="teacher-details">
                            <span style="color: var(--text-secondary);">${teacher.email}</span>
                            <span class="badge ${teacher.is_paid ? 'paid' : 'unpaid'}">
                                <i class="fas fa-${teacher.is_paid ? 'check' : 'clock'}"></i>
                                ${teacher.is_paid ? 'Pagado' : 'Pendiente'}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = listHTML;
            updatePaymentSummary();
        }

        function selectAllTeachers() {
            const checkboxes = document.querySelectorAll('.teacher-checkbox:not([disabled])');
            checkboxes.forEach(cb => cb.checked = true);
            updatePaymentSummary();
        }

        function deselectAllTeachers() {
            const checkboxes = document.querySelectorAll('.teacher-checkbox');
            checkboxes.forEach(cb => cb.checked = false);
            updatePaymentSummary();
        }

        function selectUnpaidOnly() {
            const checkboxes = document.querySelectorAll('.teacher-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = !cb.disabled;
            });
            updatePaymentSummary();
        }

        function updatePaymentSummary() {
            const selectedCheckboxes = document.querySelectorAll('.teacher-checkbox:checked');
            const selectedCount = selectedCheckboxes.length;
            const summaryText = document.getElementById('summary-text');
            const summaryAmount = document.getElementById('summary-amount');
            
            if (selectedCount === 0) {
                summaryText.textContent = 'No hay profesores seleccionados';
                summaryAmount.textContent = '$0';
            } else {
                const totalAmount = selectedCount * 30;
                summaryText.textContent = `${selectedCount} profesor${selectedCount > 1 ? 'es' : ''} seleccionado${selectedCount > 1 ? 's' : ''}`;
                summaryAmount.textContent = `$${totalAmount}`;
            }
        }

        async function markSelectedAsPaid() {
            const selectedCheckboxes = document.querySelectorAll('.teacher-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showToast('warning', 'Debes seleccionar al menos un profesor');
                return;
            }

            const teacherIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.teacherId);
            
            if (confirm(`¬øMarcar ${teacherIds.length} profesor${teacherIds.length > 1 ? 'es' : ''} como pagado${teacherIds.length > 1 ? 's' : ''}?`)) {
                try {
                    const today = new Date().toISOString().split('T')[0];
                    
                    for (const teacherId of teacherIds) {
                        await adminAuthenticatedFetch(`/api/teachers/${teacherId}/toggle-payment`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ is_paid: true })
                        });
                    }
                    
                    if (!paymentConfig.completedPayments.includes(today)) {
                        paymentConfig.completedPayments.push(today);
                        savePaymentConfig();
                    }
                    
                    await loadTeachers();
                    renderTeachersPaymentList();
                    updateStats();
                    updateCalendar();
                    addActivityLog('payment', 'Pago Selectivo', `${teacherIds.length} profesores marcados como pagados`);
                    
                    showToast('success', `${teacherIds.length} profesor${teacherIds.length > 1 ? 'es' : ''} marcado${teacherIds.length > 1 ? 's' : ''} como pagado${teacherIds.length > 1 ? 's' : ''}`);
                } catch (error) {
                    console.error('Error en pago selectivo:', error);
                    showToast('error', 'Error al procesar los pagos');
                }
            }
        }

        async function markAllAsPaid() {
            const unpaidTeachers = teachers.filter(t => t.is_active && !t.is_paid);
            
            if (unpaidTeachers.length === 0) {
                showToast('info', 'Todos los profesores activos ya est√°n marcados como pagados');
                return;
            }

            if (confirm(`¬øMarcar TODOS los ${unpaidTeachers.length} profesores pendientes como pagados?`)) {
                try {
                    const today = new Date().toISOString().split('T')[0];
                    
                    for (const teacher of unpaidTeachers) {
                        await adminAuthenticatedFetch(`/api/teachers/${teacher.id}/toggle-payment`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ is_paid: true })
                        });
                    }
                    
                    if (!paymentConfig.completedPayments.includes(today)) {
                        paymentConfig.completedPayments.push(today);
                        savePaymentConfig();
                    }
                    
                    await loadTeachers();
                    renderTeachersPaymentList();
                    updateStats();
                    updateCalendar();
                    addActivityLog('payment', 'Pago Masivo', 'Todos los profesores marcados como pagados');
                    
                    showToast('success', `${unpaidTeachers.length} profesores marcados como pagados`);
                } catch (error) {
                    console.error('Error en pago masivo:', error);
                    showToast('error', 'Error al procesar el pago masivo');
                }
            }
        }

        function generatePaymentReport() {
            const paid = teachers.filter(t => t.is_paid).length;
            const unpaid = teachers.filter(t => !t.is_paid).length;
            const total = teachers.length;
            
            const report = `
üìä REPORTE DE PAGOS - ${new Date().toLocaleDateString()}

Total Profesores: ${total}
‚úÖ Pagados: ${paid} (${((paid/total)*100).toFixed(1)}%)
‚è≥ Pendientes: ${unpaid} (${((unpaid/total)*100).toFixed(1)}%)

üí∞ Ingresos recibidos: ${paid * 30}
‚ö†Ô∏è Ingresos pendientes: ${unpaid * 30}
üìà Ingresos totales potenciales: ${total * 30}

Profesores pendientes de pago:
${teachers.filter(t => !t.is_paid).map(t => `- ${t.full_name} (${t.email})`).join('\n')}
            `;
            
            showToast('info', 'Reporte generado. Revisa la consola para m√°s detalles.');
            console.log(report);
            addActivityLog('report', 'Reporte Generado', 'Reporte de pagos consultado');
        }

        // ========================================
        // GESTI√ìN DEL CALENDARIO
        // ========================================
        function updateCalendar() {
            const calendar = document.getElementById('payment-calendar');
            const currentMonth = document.getElementById('current-month');
            
            if (!calendar || !currentMonth) {
                console.warn('Elementos del calendario no encontrados');
                return;
            }
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            currentMonth.textContent = currentDate.toLocaleDateString('es-ES', { 
                month: 'long', 
                year: 'numeric' 
            });
            
            // Limpiar calendario
            calendar.innerHTML = '';
            
            // Calcular primer d√≠a del mes y d√≠as en el mes
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            // D√≠as del mes anterior
            const prevMonth = new Date(year, month - 1, 1);
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const dayElement = createCalendarDayElement(day, 'other-month');
                calendar.appendChild(dayElement);
            }
            
            // D√≠as del mes actual
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayElement = createCalendarDayElement(day, '');
                
                // Marcar d√≠a actual
                if (dateStr === todayStr) {
                    dayElement.classList.add('today');
                }
                
                // Marcar d√≠a de pago programado
                if (day === paymentConfig.paymentDay) {
                    dayElement.classList.add('payment-scheduled');
                }
                
                // Marcar pagos completados
                if (paymentConfig.completedPayments.includes(dateStr)) {
                    dayElement.classList.add('payment-completed');
                }
                
                // Marcar fechas programadas espec√≠ficas
                if (paymentConfig.scheduledDates.includes(dateStr)) {
                    dayElement.classList.add('payment-scheduled');
                }
                
                // Marcar fines de semana
                const dayOfWeek = new Date(year, month, day).getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    dayElement.classList.add('weekend');
                }
                
                // Event listener para seleccionar fecha
                dayElement.addEventListener('click', () => selectPaymentDate(dateStr, dayElement));
                
                calendar.appendChild(dayElement);
            }
            
            // D√≠as del mes siguiente
            const totalCells = calendar.children.length;
            const remainingCells = 42 - totalCells;
            
            for (let day = 1; day <= remainingCells && remainingCells < 14; day++) {
                const dayElement = createCalendarDayElement(day, 'other-month');
                calendar.appendChild(dayElement);
            }
            
            updatePaymentConfigDisplay();
        }

        function createCalendarDayElement(day, extraClass) {
            const dayElement = document.createElement('div');
            dayElement.className = `calendar-day ${extraClass}`;
            dayElement.textContent = day;
            dayElement.dataset.day = day;
            return dayElement;
        }

        function selectPaymentDate(dateStr, dayElement) {
            // Remover selecci√≥n anterior
            document.querySelectorAll('.calendar-day.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Seleccionar nuevo d√≠a
            dayElement.classList.add('selected');
            selectedPaymentDate = dateStr;
            
            // Mostrar opciones
            const options = [
                'Programar como fecha de pago',
                'Marcar como pago completado',
                'Quitar programaci√≥n',
                'Cancelar'
            ];
            
            const choice = prompt(`üìÖ Fecha seleccionada: ${new Date(dateStr).toLocaleDateString('es-ES')}\n\nElige una opci√≥n:\n1. ${options[0]}\n2. ${options[1]}\n3. ${options[2]}\n4. ${options[3]}\n\nEscribe el n√∫mero (1-4):`);
            
            switch(choice) {
                case '1':
                    schedulePaymentDate(dateStr);
                    break;
                case '2':
                    markPaymentCompleted(dateStr);
                    break;
                case '3':
                    removePaymentDate(dateStr);
                    break;
                default:
                    dayElement.classList.remove('selected');
                    selectedPaymentDate = null;
            }
        }

        function schedulePaymentDate(dateStr) {
            if (!paymentConfig.scheduledDates.includes(dateStr)) {
                paymentConfig.scheduledDates.push(dateStr);
                savePaymentConfig();
                updateCalendar();
                addActivityLog('payment', 'Fecha Programada', `Fecha de pago programada: ${new Date(dateStr).toLocaleDateString('es-ES')}`);
                showToast('success', 'Fecha de pago programada correctamente');
            }
        }

        function markPaymentCompleted(dateStr) {
            if (!paymentConfig.completedPayments.includes(dateStr)) {
                paymentConfig.completedPayments.push(dateStr);
                savePaymentConfig();
                updateCalendar();
                addActivityLog('payment', 'Pago Completado', `Pago marcado como completado: ${new Date(dateStr).toLocaleDateString('es-ES')}`);
                showToast('success', 'Pago marcado como completado');
            }
        }

        function removePaymentDate(dateStr) {
            paymentConfig.scheduledDates = paymentConfig.scheduledDates.filter(date => date !== dateStr);
            paymentConfig.completedPayments = paymentConfig.completedPayments.filter(date => date !== dateStr);
            savePaymentConfig();
            updateCalendar();
            addActivityLog('payment', 'Fecha Removida', `Programaci√≥n removida: ${new Date(dateStr).toLocaleDateString('es-ES')}`);
            showToast('success', 'Programaci√≥n removida');
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            updateCalendar();
        }

        function savePaymentConfig() {
            localStorage.setItem('paymentConfig', JSON.stringify(paymentConfig));
        }

        function loadPaymentConfig() {
            const saved = localStorage.getItem('paymentConfig');
            if (saved) {
                paymentConfig = { ...paymentConfig, ...JSON.parse(saved) };
            }
            updatePaymentConfigDisplay();
        }

        function updatePaymentConfigDisplay() {
            const paymentDayConfig = document.getElementById('payment-day-config');
            const autoPaymentReset = document.getElementById('auto-payment-reset');
            
            if (paymentDayConfig) {
                paymentDayConfig.textContent = paymentConfig.paymentDay;
            }
            
            if (autoPaymentReset) {
                autoPaymentReset.checked = paymentConfig.autoReset;
            }
        }

        function changePaymentDay() {
            const newDay = prompt('¬øQu√© d√≠a del mes debe ser el pago autom√°tico?\n(Ingresa un n√∫mero del 1 al 31):', paymentConfig.paymentDay);
            
            if (newDay && !isNaN(newDay) && newDay >= 1 && newDay <= 31) {
                paymentConfig.paymentDay = parseInt(newDay);
                savePaymentConfig();
                updateCalendar();
                addActivityLog('config', 'D√≠a de Pago Cambiado', `Nuevo d√≠a de pago: ${newDay}`);
                showToast('success', `D√≠a de pago cambiado al ${newDay} de cada mes`);
            }
        }

        function toggleAutoPaymentReset() {
            const checkbox = document.getElementById('auto-payment-reset');
            paymentConfig.autoReset = checkbox.checked;
            savePaymentConfig();
            addActivityLog('config', 'Auto-Reset Cambiado', `Auto-reset ${paymentConfig.autoReset ? 'activado' : 'desactivado'}`);
        }

        // ========================================
        // GESTI√ìN DE SESIONES
        // ========================================
        async function loadSessions() {
            try {
                const response = await adminAuthenticatedFetch('/api/sessions/active');
                const data = await response.json();
                
                if (data.success) {
                    sessions = data.data;
                } else {
                    sessions = [];
                }
            } catch (error) {
                console.error('Error cargando sesiones:', error);
                sessions = [];
            }
            
            renderSessionsTable();
        }

        function renderSessionsTable() {
            const container = document.getElementById('sessions-table-container');
            
            if (!container) return;
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                        <i class="fas fa-lock" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h4>No hay sesiones activas</h4>
                        <p>Ning√∫n profesor tiene sesi√≥n iniciada en este momento</p>
                    </div>
                `;
                return;
            }
            
            const tableHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th><i class="fas fa-user"></i> Profesor</th>
                                <th><i class="fas fa-envelope"></i> Email</th>
                                <th><i class="fas fa-network-wired"></i> IP</th>
                                <th><i class="fas fa-clock"></i> √öltima Actividad</th>
                                <th><i class="fas fa-signal"></i> Estado</th>
                                <th><i class="fas fa-cogs"></i> Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sessions.map(session => `
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 32px; height: 32px; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;">
                                                ${session.teacher_name.charAt(0).toUpperCase()}
                                            </div>
                                            <strong>${session.teacher_name}</strong>
                                        </div>
                                    </td>
                                    <td>${session.email}</td>
                                    <td>
                                        <code style="background: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: 4px;">
                                            ${session.ip || 'N/A'}
                                        </code>
                                    </td>
                                    <td>
                                        <small style="color: var(--text-secondary);">
                                            ${getTimeAgo(new Date(session.last_activity))}
                                        </small>
                                    </td>
                                    <td>
                                        <span class="badge ${session.status === 'active' ? 'active' : 'inactive'}">
                                            <i class="fas fa-${session.status === 'active' ? 'check-circle' : 'clock'}"></i>
                                            ${session.status === 'active' ? 'Activo' : 'Inactivo'}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-danger" onclick="disconnectSession(${session.id})">
                                            <i class="fas fa-sign-out-alt"></i>
                                            Desconectar
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 1) return 'Ahora mismo';
            if (minutes < 60) return `Hace ${minutes} min`;
            
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `Hace ${hours} hora${hours > 1 ? 's' : ''}`;
            
            const days = Math.floor(hours / 24);
            return `Hace ${days} d√≠a${days > 1 ? 's' : ''}`;
        }

        async function disconnectSession(sessionId) {
            if (confirm('¬øDesconectar esta sesi√≥n?')) {
                try {
                    const session = sessions.find(s => s.id === sessionId);
                    if (session) {
                        const response = await adminAuthenticatedFetch('/api/teachers/logout', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                sessionToken: session.session_token
                            })
                        });
                        
                        if (response.ok) {
                            await loadSessions();
                            updateStats();
                            addActivityLog('session', 'Sesi√≥n Desconectada', `Sesi√≥n de ${session.teacher_name} terminada por administrador`);
                            showToast('success', 'Sesi√≥n desconectada correctamente');
                        } else {
                            showToast('error', 'Error desconectando sesi√≥n');
                        }
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showToast('error', 'Error desconectando sesi√≥n');
                }
            }
        }

        function refreshSessions() {
            const button = event.target;
            const originalHTML = button.innerHTML;
            button.innerHTML = '<div class="loading-spinner"></div> Actualizando...';
            button.disabled = true;

            loadSessions();
            updateStats();
            addActivityLog('refresh', 'Actualizaci√≥n Manual', 'Estado de sesiones actualizado manualmente');
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.disabled = false;
                showToast('success', 'Estado de sesiones actualizado');
            }, 1000);
        }

        // ========================================
        // ESTAD√çSTICAS
        // ========================================
        async function updateStats() {
            try {
                console.log('üìä Actualizando estad√≠sticas de admin...');
                
                const response = await adminAuthenticatedFetch('/api/admin/stats');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || 'Error obteniendo estad√≠sticas');
                }
                
                const stats = data.data;
                console.log('‚úÖ Estad√≠sticas recibidas:', stats);
                
                // Actualizar contadores principales
                updateStatElement('total-teachers', stats.total_teachers || 0);
                updateStatElement('active-sessions', stats.active_teachers || 0);
                updateStatElement('paid-teachers', stats.paid_teachers || 0);
                updateStatElement('unpaid-teachers', stats.unpaid_teachers || 0);
                
                // Actualizar m√©tricas adicionales
                updateStatElement('revenue-month', `${(stats.paid_teachers * 30) || 0}`);
                updateStatElement('active-schools', stats.total_schools || 0);
                
                console.log('‚úÖ Estad√≠sticas actualizadas en la interfaz');
                
            } catch (error) {
                console.error('‚ùå Error actualizando estad√≠sticas:', error);
                
                // Mostrar valores por defecto en caso de error
                updateStatElement('total-teachers', 0);
                updateStatElement('active-teachers', 0);
                updateStatElement('total-schools', 0);
                updateStatElement('active-sessions', 0);
                updateStatElement('revenue-month', '0');
                updateStatElement('active-schools', 0);
            }
        }

        function updateStatElement(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                if (typeof value === 'number') {
                    const currentValue = parseInt(element.textContent) || 0;
                    if (currentValue !== value) {
                        animateNumber(element, currentValue, value);
                    }
                } else {
                    element.textContent = value;
                }
            }
        }

        function animateNumber(element, from, to) {
            const duration = 1000;
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentValue = Math.round(from + (to - from) * easeOutQuart);
                
                element.textContent = currentValue;
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        // ========================================
        // LOG DE ACTIVIDAD
        // ========================================
        function addActivityLog(type, title, description) {
            const log = {
                id: Date.now(),
                type,
                title,
                description,
                timestamp: new Date()
            };
            
            const existingLogs = JSON.parse(localStorage.getItem('adminActivityLog') || '[]');
            existingLogs.unshift(log);
            
            if (existingLogs.length > 100) {
                existingLogs.splice(100);
            }
            
            localStorage.setItem('adminActivityLog', JSON.stringify(existingLogs));
            
            // Solo recargar si estamos en la pesta√±a de actividad
            if (document.getElementById('activity-tab').classList.contains('active')) {
                loadActivityLog();
            }
        }

        function loadActivityLog() {
            const logs = JSON.parse(localStorage.getItem('adminActivityLog') || '[]');
            const container = document.getElementById('activity-log');
            
            if (!container) return;
            
            if (logs.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                        <i class="fas fa-history" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h4>No hay actividad registrada</h4>
                        <p>La actividad del sistema aparecer√° aqu√≠</p>
                    </div>
                `;
                return;
            }
            
            const iconMap = {
                status: 'user-cog',
                payment: 'dollar-sign',
                session: 'lock',
                refresh: 'sync-alt',
                report: 'chart-bar',
                error: 'exclamation-circle',
                navigation: 'mouse-pointer',
                config: 'cog',
                export: 'download'
            };
            
            const colorMap = {
                status: 'var(--info)',
                payment: 'var(--success)',
                session: 'var(--warning)',
                refresh: 'var(--primary)',
                report: 'var(--info)',
                error: 'var(--danger)',
                navigation: 'var(--secondary)',
                config: 'var(--warning)',
                export: 'var(--success)'
            };
            
            const logHTML = logs.map(log => `
                <div class="log-entry">
                    <div class="log-icon" style="background: ${colorMap[log.type] || 'var(--primary)'};">
                        <i class="fas fa-${iconMap[log.type] || 'info'}"></i>
                    </div>
                    <div class="log-content">
                        <div class="log-title">${log.title}</div>
                        <div class="log-details">${log.description}</div>
                    </div>
                    <div class="log-time">${new Date(log.timestamp).toLocaleString('es-ES')}</div>
                </div>
            `).join('');
            
            container.innerHTML = logHTML;
        }

        function clearActivityLog() {
            if (confirm('¬øLimpiar todo el log de actividad?')) {
                localStorage.removeItem('adminActivityLog');
                loadActivityLog();
                addActivityLog('system', 'Log Limpiado', 'Historial de actividad eliminado');
                showToast('success', 'Log de actividad limpiado');
            }
        }

        function exportActivityLog() {
            const logs = JSON.parse(localStorage.getItem('adminActivityLog') || '[]');
            
            if (logs.length === 0) {
                showToast('warning', 'No hay actividad para exportar');
                return;
            }
            
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Tipo,T√≠tulo,Descripci√≥n,Fecha\n" +
                logs.map(log => 
                    `"${log.type}","${log.title}","${log.description}","${new Date(log.timestamp).toLocaleString('es-ES')}"`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `activity_log_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addActivityLog('export', 'Log Exportado', 'Log de actividad exportado a CSV');
            showToast('success', 'Log de actividad exportado correctamente');
        }

        // ========================================
        // FUNCIONES ADICIONALES DEL OVERVIEW
        // ========================================
        function refreshOverview() {
            const button = event.target;
            const originalHTML = button.innerHTML;
            button.innerHTML = '<div class="loading-spinner"></div> Actualizando...';
            button.disabled = true;

            Promise.all([
                updateStats(),
                loadTeachers(),
                loadSessions()
            ]).then(() => {
                addActivityLog('refresh', 'Overview Actualizado', 'Dashboard general actualizado');
                showToast('success', 'Dashboard actualizado correctamente');
            }).finally(() => {
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }, 1000);
            });
        }

        async function activateAllPendingTeachers() {
            const pendingTeachers = teachers.filter(t => !t.is_active);
            
            if (pendingTeachers.length === 0) {
                showToast('info', 'No hay profesores pendientes de activaci√≥n');
                return;
            }

            if (confirm(`¬øActivar todos los ${pendingTeachers.length} profesores pendientes?`)) {
                try {
                    for (const teacher of pendingTeachers) {
                        await adminAuthenticatedFetch(`/api/teachers/${teacher.id}/toggle-status`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ action: 'activate' })
                        });
                    }
                    
                    await loadTeachers();
                    updateStats();
                    addActivityLog('status', 'Activaci√≥n Masiva', `${pendingTeachers.length} profesores activados`);
                    showToast('success', `${pendingTeachers.length} profesores activados correctamente`);
                } catch (error) {
                    console.error('Error activando profesores:', error);
                    showToast('error', 'Error al activar profesores');
                }
            }
        }

        function sendWelcomeEmails() {
            const newTeachers = teachers.filter(t => t.is_active && !t.last_login);
            
            if (newTeachers.length === 0) {
                showToast('info', 'No hay profesores nuevos para enviar emails de bienvenida');
                return;
            }

            // Simular env√≠o de emails de bienvenida
            setTimeout(() => {
                addActivityLog('email', 'Emails Enviados', `Emails de bienvenida enviados a ${newTeachers.length} profesores nuevos`);
                showToast('success', `Emails de bienvenida enviados a ${newTeachers.length} profesores`);
            }, 1000);
        }

        function generateSystemReport() {
            const activeTeachers = teachers.filter(t => t.is_active).length;
            const inactiveTeachers = teachers.filter(t => !t.is_active).length;
            const total = teachers.length;
            
            // Simular generaci√≥n de reporte del sistema
            setTimeout(() => {
                const reportData = {
                    totalTeachers: total,
                    activeTeachers: activeTeachers,
                    inactiveTeachers: inactiveTeachers,
                    activationRate: ((activeTeachers / total) * 100).toFixed(1)
                };
                
                console.log('üìä REPORTE DEL SISTEMA:', reportData);
                addActivityLog('report', 'Reporte del Sistema', `Reporte generado - ${activeTeachers}/${total} profesores activos`);
                showToast('success', 'Reporte del sistema generado correctamente');
            }, 1500);
        }

        function backupDatabase() {
            // Simular backup
            setTimeout(() => {
                addActivityLog('system', 'Backup Creado', 'Respaldo de base de datos creado');
                showToast('success', 'Respaldo de base de datos creado correctamente');
            }, 2000);
        }

        // ========================================
        // FUNCIONES DE ANAL√çTICAS
        // ========================================
        function refreshAnalytics() {
            const button = event.target;
            const originalHTML = button.innerHTML;
            button.innerHTML = '<div class="loading-spinner"></div> Actualizando...';
            button.disabled = true;

            // Simular carga de anal√≠ticas
            setTimeout(() => {
                // Actualizar m√©tricas simuladas
                updateStatElement('total-logins', Math.floor(Math.random() * 1000) + 500);
                updateStatElement('avg-session-time', Math.floor(Math.random() * 60) + 15 + 'min');
                
                addActivityLog('refresh', 'Anal√≠ticas Actualizadas', 'M√©tricas del sistema actualizadas');
                showToast('success', 'Anal√≠ticas actualizadas correctamente');
                
                button.innerHTML = originalHTML;
                button.disabled = false;
            }, 1500);
        }

        function exportAnalytics() {
            // Simular exportaci√≥n
            setTimeout(() => {
                addActivityLog('export', 'Anal√≠ticas Exportadas', 'Datos de anal√≠ticas exportados');
                showToast('success', 'Anal√≠ticas exportadas correctamente');
            }, 1000);
        }

        // ========================================
        // UTILIDADES GENERALES
        // ========================================
        function logoutAdmin() {
            if (confirm('¬øEst√°s seguro de que quieres cerrar la sesi√≥n administrativa?')) {
                sessionStorage.removeItem('adminSession');
                sessionStorage.removeItem('adminUser');
                addActivityLog('session', 'Logout Admin', 'Sesi√≥n administrativa cerrada');
                showToast('info', 'Sesi√≥n cerrada. Redirigiendo...');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);
            }
        }

        // ========================================
        // EVENTOS Y INICIALIZACI√ìN FINAL
        // ========================================
        
        // Agregar log inicial despu√©s de un breve delay
        setTimeout(() => {
            addActivityLog('session', 'Login Admin', 'Sesi√≥n administrativa iniciada');
        }, 2000);

        // Actualizar estad√≠sticas al cambiar de pesta√±a
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                updateStats();
            }
        });

        // Manejar errores globales
        window.addEventListener('error', function(event) {
            console.error('Error global:', event.error);
            addActivityLog('error', 'Error del Sistema', event.error.message || 'Error desconocido');
        });

        // Prevenir p√©rdida de datos al salir
        window.addEventListener('beforeunload', function(event) {
            // Guardar logs de actividad antes de salir
            // Los logs ya se guardan autom√°ticamente en localStorage
        });

        console.log('‚úÖ Panel de administraci√≥n completamente inicializado');
    </script>
</body>
</html>