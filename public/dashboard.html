<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduOne - Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Colores modo claro */
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1a202c;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --border-hover: #cbd5e1;
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            /* Colores modo oscuro */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --border-hover: #475569;
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* =========================
           SISTEMA DE NOTIFICACIONES
        ========================= */
        .notification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .notification-overlay.show {
            opacity: 1;
        }

        .notification-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            min-width: 320px;
            max-width: 500px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .notification-modal.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .notification-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            position: relative;
            overflow: hidden;
        }

        .notification-icon.loading {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            animation: pulse-glow 2s infinite;
        }

        .notification-icon.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            animation: success-bounce 0.6s ease;
        }

        .notification-icon.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            animation: error-shake 0.6s ease;
        }

        .notification-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 12px 0;
        }

        .notification-message {
            font-size: 1rem;
            color: var(--text-secondary);
            margin: 0 0 16px 0;
            line-height: 1.5;
        }

        .notification-details {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            border: 1px solid var(--border-color);
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            font-size: 0.875rem;
        }

        .detail-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .detail-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .detail-change {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #667eea;
            font-weight: 600;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        /* Animaciones para notificaciones */
        @keyframes pulse-glow {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
            }
        }

        @keyframes success-bounce {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes error-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-md);
            min-width: 300px;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: auto;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast.info {
            border-left: 4px solid #667eea;
        }

        .toast-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 2px 0;
        }

        .toast-message {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Spinner en botones */
        .btn-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0;
        }

        /* Mejoras para botones durante el loading */
        .action-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }

        .action-btn:disabled:hover {
            transform: none !important;
        }

        /* Suavizar todas las transiciones */
        .expandable-panel {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 0;
            overflow: hidden;
            opacity: 0;
        }

        .expandable-panel.show {
            max-height: 1000px;
            opacity: 1;
        }

        .expandable-panel.hide {
            max-height: 0;
            opacity: 0;
        }

        /* Efectos suaves para cambios de estado */
        .current-period {
            transition: all 0.3s ease;
        }

        .profile-details h2,
        .profile-details .school {
            transition: all 0.3s ease;
        }

        /* Click del overlay para cerrar modal */
        .notification-overlay {
            cursor: pointer;
        }

        .notification-modal {
            cursor: default;
        }
        .eduone-logo {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-block;
        }

        .eduone-xl { font-size: 4rem; }
        .eduone-lg { font-size: 3rem; }
        .eduone-md { font-size: 2rem; }
        .eduone-sm { font-size: 1.5rem; }
        .eduone-xs { font-size: 1rem; }

        .eduone-dark {
            background: linear-gradient(135deg, #a78bfa 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* =========================
           HEADER PRINCIPAL
        ========================= */
        .main-header {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 32px 40px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            position: relative;
            transition: all 0.3s ease;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 24px;
        }

        .brand-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .brand-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            flex-shrink: 0;
        }

        .brand-text h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 0 4px 0;
        }

        .brand-text p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 500;
            margin: 0;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            color: var(--text-secondary);
        }

        .theme-toggle:hover {
            background: var(--border-color);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 16px;
            background: var(--bg-tertiary);
            padding: 16px 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .user-info h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 2px 0;
        }

        .user-info span {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .logout-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        /* =========================
           ESTADÍSTICAS ADMIN
        ========================= */
        .admin-stats {
            margin-bottom: 32px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 28px;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--border-hover);
        }

        .stat-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #667eea;
            flex-shrink: 0;
        }

        .stat-info h3 {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            margin: 0 0 4px 0;
        }

        .stat-info p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }

        /* =========================
           PERFIL PROFESOR
        ========================= */
        .teacher-profile {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
            position: relative;
            transition: all 0.3s ease;
        }

        .teacher-profile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .profile-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 24px;
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile-avatar {
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
        }

        .profile-details h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 4px 0;
        }

        .profile-details .school {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
            margin: 0 0 8px 0;
        }

        .current-period {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .profile-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .action-btn:hover {
            transform: translateY(-1px);
        }

        .btn-primary:hover { background: #5a67d8; }
        .btn-secondary:hover { 
            background: var(--border-color); 
        }

        /* =========================
           INFORMACIÓN DEL PROFESOR
        ========================= */
        .teacher-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .info-item {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s ease;
        }

        .info-item:hover {
            border-color: var(--border-hover);
            transform: translateY(-1px);
        }

        .info-icon {
            width: 48px;
            height: 48px;
            background: var(--bg-secondary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-size: 18px;
            border: 1px solid var(--border-color);
        }

        .info-content h4 {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0 0 4px 0;
        }

        .info-content p {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 600;
            margin: 0;
        }

        /* =========================
           PANELES EXPANDIBLES
        ========================= */
        .expandable-panel {
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin-top: 24px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            display: none;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 0;
            opacity: 0;
        }

        .panel-header {
            background: var(--bg-secondary);
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .panel-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 4px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .panel-content {
            padding: 24px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-input, .form-select {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* =========================
           MÓDULOS
        ========================= */
        .modules-section {
            margin-top: 40px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .section-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            font-weight: 500;
            margin: 0;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        .module-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .module-card:hover::before {
            transform: scaleX(1);
        }

        .module-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--border-hover);
        }

        .module-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .module-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 12px 0;
        }

        .module-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
            margin: 0 0 20px 0;
        }

        .module-status {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-ready {
            background: rgba(34, 197, 94, 0.1);
            color: #059669;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .status-development {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-planned {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .status-admin {
            background: rgba(236, 72, 153, 0.1);
            color: #be185d;
            border: 1px solid rgba(236, 72, 153, 0.2);
        }

        /* =========================
           FOOTER
        ========================= */
        .footer {
            text-align: center;
            margin-top: 60px;
            padding: 32px;
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .footer p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin: 0;
        }

        .footer a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .footer a:hover {
            color: #5a67d8;
        }

        /* =========================
           UTILIDADES
        ========================= */
        .admin-only {
            display: none;
        }

        .teacher-only {
            display: none;
        }

        /* =========================
           RESPONSIVE
        ========================= */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .header-right {
                order: -1;
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .brand-text h1 {
                font-size: 2rem;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-info {
                flex-direction: column;
                text-align: center;
            }

            .modules-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .teacher-info-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .toast {
                min-width: 280px;
                margin: 0 16px 12px 0;
            }

            .notification-modal {
                margin: 0 16px;
                min-width: 280px;
                max-width: calc(100vw - 32px);
            }

            .toast-container {
                right: 16px;
                left: 16px;
            }
        }

        /* =========================
           MODO OSCURO ESPECÍFICOS
        ========================= */
        [data-theme="dark"] .eduone-logo {
            background: linear-gradient(135deg, #a78bfa 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        [data-theme="dark"] .logout-btn {
            background: #ef4444;
            color: white;
        }

        [data-theme="dark"] .logout-btn:hover {
            background: #dc2626;
        }

        /* Mejoras para modo oscuro en elementos específicos */
        [data-theme="dark"] .current-period {
            background: rgba(139, 92, 246, 0.15);
            border-color: rgba(139, 92, 246, 0.3);
        }

        [data-theme="dark"] .module-card:hover {
            background: var(--bg-tertiary);
        }

        [data-theme="dark"] .stat-card:hover {
            background: var(--bg-tertiary);
        }

        /* =========================
           ANIMACIONES
        ========================= */
        .fade-in {
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <script src="js/global-period-selector.js"></script>
    <div class="container">
        <!-- Overlay y Modal de Notificaciones -->
        <div class="notification-overlay" id="notificationOverlay">
            <div class="notification-modal" id="notificationModal">
                <div class="notification-icon" id="notificationIcon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <h3 class="notification-title" id="notificationTitle">Cambiando Período</h3>
                <p class="notification-message" id="notificationMessage">Por favor espera mientras actualizamos tu período académico...</p>
                <div class="notification-details" id="notificationDetails" style="display: none;">
                    <!-- Los detalles se llenarán dinámicamente -->
                </div>
                <div class="spinner" id="notificationSpinner"></div>
            </div>
        </div>

        <!-- Contenedor de Toasts -->
        <div class="toast-container" id="toastContainer"></div>
        <!-- Header Principal -->
        <header class="main-header fade-in">
            <div class="header-content">
                <div class="brand-section">
                    <div class="brand-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="brand-text">
                        <h1 class="eduone-logo eduone-lg">EduOne</h1>
                        <p>Sistema Integral de Gestión Educativa</p>
                    </div>
                </div>
                
                <div class="header-right">
                    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggleBtn" title="Cambiar tema">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    
                    <div class="user-section" id="userSection" style="display: none;">
                        <div class="user-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="user-info">
                            <h3 id="currentUserName">Usuario</h3>
                            <span id="currentUserRole">Rol</span>
                        </div>
                        <button class="logout-btn" onclick="logoutUser()">
                            <i class="fas fa-sign-out-alt"></i>
                            Salir
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Estadísticas Admin -->
        <section class="admin-stats admin-only" id="adminStatsSection">
            <div class="stats-grid">
                <div class="stat-card fade-in">
                    <div class="stat-content">
                        <div class="stat-icon">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="professorsCount">0</h3>
                            <p>Profesores Activos</p>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card fade-in">
                    <div class="stat-content">
                        <div class="stat-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="studentsCount">0</h3>
                            <p>Estudiantes</p>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card fade-in">
                    <div class="stat-content">
                        <div class="stat-icon">
                            <i class="fas fa-school"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="schoolsCount">0</h3>
                            <p>Escuelas</p>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card fade-in">
                    <div class="stat-content">
                        <div class="stat-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stat-info">
                            <h3>7</h3>
                            <p>Módulos Activos</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Perfil del Profesor -->
        <section class="teacher-profile teacher-only" id="teacherProfileSection">
            <div class="profile-header">
                <div class="profile-info">
                    <div class="profile-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="profile-details">
                        <h2 id="teacherProfileName">Cargando...</h2>
                        <div class="school" id="teacherProfileSchool">Escuela</div>
                        <div class="current-period">
                            <i class="fas fa-calendar"></i>
                            <span id="currentPeriodText">2025 - Primer Semestre</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-actions">
                    <button class="action-btn btn-primary" onclick="togglePeriodSelector()" id="periodSelectorBtn">
                        <i class="fas fa-calendar-alt"></i>
                        Período Académico
                    </button>
                    <button class="action-btn btn-secondary" onclick="toggleQuickEdit()" id="quickEditBtn">
                        <i class="fas fa-edit"></i>
                        Editar Perfil
                    </button>
                </div>
            </div>

            <!-- Información del Profesor -->
            <div class="teacher-info-grid">
                <div class="info-item">
                    <div class="info-icon">
                        <i class="fas fa-id-card"></i>
                    </div>
                    <div class="info-content">
                        <h4>Cédula</h4>
                        <p id="teacherCedula">-</p>
                    </div>
                </div>
                
                <div class="info-item">
                    <div class="info-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="info-content">
                        <h4>Email</h4>
                        <p id="teacherEmail">-</p>
                    </div>
                </div>
                
                <div class="info-item">
                    <div class="info-icon">
                        <i class="fas fa-user-tag"></i>
                    </div>
                    <div class="info-content">
                        <h4>Tipo</h4>
                        <p id="teacherType">-</p>
                    </div>
                </div>
                
                <div class="info-item">
                    <div class="info-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="info-content">
                        <h4>Regional</h4>
                        <p id="teacherRegional">-</p>
                    </div>
                </div>
                
                <div class="info-item">
                    <div class="info-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="info-content">
                        <h4>Estudiantes</h4>
                        <p id="teacherStudentsCount">-</p>
                    </div>
                </div>
                
                <div class="info-item">
                    <div class="info-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="info-content">
                        <h4>Activo desde</h4>
                        <p id="teacherSince">-</p>
                    </div>
                </div>
            </div>

            <!-- Panel Selector de Período -->
            <div class="expandable-panel" id="periodSelectorPanel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-calendar-week"></i>
                        Configuración del Período Académico
                    </h3>
                    <p class="panel-subtitle">Selecciona el período académico que deseas gestionar</p>
                </div>
                <div class="panel-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-school"></i>
                                Escuela
                            </label>
                            <select id="schoolSelector" class="form-select">
                                <option value="1">Mi Escuela Principal</option>
                                <option value="2" disabled>+ Agregar Segunda Escuela</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-calendar-alt"></i>
                                Año
                            </label>
                            <select id="yearSelector" class="form-select">
                                <option value="2024">2024</option>
                                <option value="2025" selected>2025</option>
                                <option value="2026">2026</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-calendar-week"></i>
                                Tipo
                            </label>
                            <select id="periodTypeSelector" class="form-select">
                                <option value="semester" selected>Semestre</option>
                                <option value="trimester">Trimestre</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-list-ol"></i>
                                Período
                            </label>
                            <select id="periodSelector" class="form-select">
                                <option value="1" selected>Primer Semestre</option>
                                <option value="2">Segundo Semestre</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="applyPeriodBtn" class="action-btn btn-primary">
                            <i class="fas fa-check"></i>
                            Aplicar Período
                        </button>
                        <button onclick="togglePeriodSelector()" class="action-btn btn-secondary">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Panel Edición Rápida -->
            <div class="expandable-panel" id="quickEditPanel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-user-edit"></i>
                        Editar Mi Perfil
                    </h3>
                    <p class="panel-subtitle">Actualiza tu información personal y escolar</p>
                </div>
                <div class="panel-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user"></i>
                                Nombre Completo
                            </label>
                            <input type="text" id="quickEditName" class="form-input" placeholder="Ingresa tu nombre completo">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-school"></i>
                                Nombre de la Escuela
                            </label>
                            <input type="text" id="quickEditSchool" class="form-input" placeholder="Ingresa el nombre de tu escuela">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button onclick="saveQuickEdit()" class="action-btn btn-primary">
                            <i class="fas fa-save"></i>
                            Guardar Cambios
                        </button>
                        <button onclick="cancelQuickEdit()" class="action-btn btn-secondary">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Módulos del Sistema -->
        <section class="modules-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-th-large"></i>
                    Módulos del Sistema
                </h2>
                <p class="section-subtitle">Gestiona todos los aspectos de tu actividad académica</p>
            </div>
            
            <div class="modules-grid">
                <!-- Módulo Admin -->
                <div class="module-card admin-only fade-in" onclick="openModule('admin')">
                    <div class="module-icon">👑</div>
                    <h3 class="module-title">Administración</h3>
                    <p class="module-description">
                        Panel de control administrativo completo para gestión de profesores y configuración del sistema
                    </p>
                    <div class="module-status status-admin">Solo Admin</div>
                </div>

                <!-- Módulo Estudiantes -->
                <div class="module-card fade-in" onclick="openModule('estudiantes')">
                    <div class="module-icon">👨‍🎓</div>
                    <h3 class="module-title">Estudiantes</h3>
                    <p class="module-description">
                        Gestión completa de estudiantes - Registro, edición y consulta de información académica
                    </p>
                    <div class="module-status status-ready">Disponible</div>
                </div>
                
                <!-- Módulo Asistencia -->
                <div class="module-card fade-in" onclick="openModule('asistencia')">
                    <div class="module-icon">📅</div>
                    <h3 class="module-title">Asistencia</h3>
                    <p class="module-description">
                        Control diario de asistencia, tardanzas y reportes según normativas del MEP
                    </p>
                    <div class="module-status status-ready">Disponible</div>
                </div>
                
                <!-- Módulo Cotidiano -->
                <div class="module-card fade-in" onclick="openModule('cotidiano')">
                    <div class="module-icon">📊</div>
                    <h3 class="module-title">Cotidiano</h3>
                    <p class="module-description">
                        Registro diario de calificaciones, participación y comportamiento de estudiantes
                    </p>
                    <div class="module-status status-ready">Disponible</div>
                </div>
                
                <!-- Módulo Evaluaciones -->
                <div class="module-card fade-in" onclick="openModule('evaluaciones')">
                    <div class="module-icon">📝</div>
                    <h3 class="module-title">Evaluaciones</h3>
                    <p class="module-description">
                        Creación, gestión y calificación de tareas, exámenes y proyectos académicos
                    </p>
                    <div class="module-status status-ready">Disponible</div>
                </div>
                
                <!-- Módulo Materias -->
                <div class="module-card fade-in" onclick="openModule('materias')">
                    <div class="module-icon">📚</div>
                    <h3 class="module-title">Materias</h3>
                    <p class="module-description">
                        Gestión de materias académicas, asignación por grados y configuración curricular
                    </p>
                    <div class="module-status status-ready">Disponible</div>
                </div>
                
                <!-- Módulo Reportes -->
                <div class="module-card fade-in" onclick="openModule('reportes')">
                    <div class="module-icon">📈</div>
                    <h3 class="module-title">Reportes</h3>
                    <p class="module-description">
                        Generación de reportes académicos, estadísticas y análisis de rendimiento estudiantil
                    </p>
                    <div class="module-status status-planned">Planificado</div>
                </div>
                
                <!-- Módulo SEA --> 
                <div class="module-card fade-in" onclick="openModule('sea')">
                    <div class="module-icon">🎯</div>
                    <h3 class="module-title">SEA</h3>
                    <p class="module-description">
                        Sistema de Evaluación Académica - Vista consolidada con ponderaciones reales del MEP
                    </p>
                    <div class="module-status status-ready">Disponible</div>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="footer fade-in">
            <p>
                <a href="login.html"><i class="fas fa-arrow-left"></i> Volver al Login</a> | 
                © 2025 <span class="eduone-logo eduone-xs">EduOne</span> - Sistema Integral de Gestión Educativa v2.0
            </p>
        </footer>
    </div>

    <script>
        // Helper para peticiones con autenticación
        async function authenticatedFetch(url, options = {}) {
            const token = localStorage.getItem('sessionToken');
            
            const defaultOptions = {
                headers: {
                    'Authorization': token ? `Bearer ${token}` : '',
                    'Content-Type': 'application/json'
                }
            };

            const mergedOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...(options.headers || {})
                }
            };

            const response = await fetch(url, mergedOptions);

            if (response.status === 401) {
                // VERIFICAR SI ES ADMIN ANTES DE REDIRECCIONAR
                const adminSession = sessionStorage.getItem('adminSession');
                
                if (adminSession === 'true') {
                    console.log('⚠️ Request 401 ignorado para sesión de administrador');
                    return Promise.reject(new Error('Unauthorized - Admin session'));
                }
                
                localStorage.removeItem('sessionToken');
                localStorage.removeItem('teacherInfo');
                window.location.href = '/login.html';
                return Promise.reject(new Error('Unauthorized'));
            }

            return response;
        }

        // =========================
        // SISTEMA DE NOTIFICACIONES
        // =========================
        
        class NotificationSystem {
            constructor() {
                this.overlay = document.getElementById('notificationOverlay');
                this.modal = document.getElementById('notificationModal');
                this.icon = document.getElementById('notificationIcon');
                this.title = document.getElementById('notificationTitle');
                this.message = document.getElementById('notificationMessage');
                this.details = document.getElementById('notificationDetails');
                this.spinner = document.getElementById('notificationSpinner');
                this.toastContainer = document.getElementById('toastContainer');
            }

            showModal(type, title, message, details = null) {
                // Configurar contenido
                this.title.textContent = title;
                this.message.textContent = message;
                
                // Configurar icono según tipo
                this.icon.className = `notification-icon ${type}`;
                
                if (type === 'loading') {
                    this.icon.innerHTML = '<div class="spinner"></div>';
                    this.spinner.style.display = 'block';
                } else if (type === 'success') {
                    this.icon.innerHTML = '<i class="fas fa-check"></i>';
                    this.spinner.style.display = 'none';
                } else if (type === 'error') {
                    this.icon.innerHTML = '<i class="fas fa-times"></i>';
                    this.spinner.style.display = 'none';
                }

                // Mostrar detalles si se proporcionan
                if (details) {
                    this.details.innerHTML = details;
                    this.details.style.display = 'block';
                } else {
                    this.details.style.display = 'none';
                }

                // Mostrar modal con animación suave
                this.overlay.style.display = 'block';
                setTimeout(() => {
                    this.overlay.classList.add('show');
                    this.modal.classList.add('show');
                }, 10);
            }

            hideModal() {
                this.overlay.classList.remove('show');
                this.modal.classList.remove('show');
                
                setTimeout(() => {
                    this.overlay.style.display = 'none';
                }, 400);
            }

            showToast(type, title, message, duration = 4000) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const iconClass = type === 'success' ? 'fa-check-circle' : 
                                 type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
                
                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="fas ${iconClass}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                `;

                this.toastContainer.appendChild(toast);
                
                // Mostrar con animación
                setTimeout(() => toast.classList.add('show'), 10);
                
                // Auto-remover
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 400);
                }, duration);
            }

            generateChangeDetails(oldPeriod, newPeriod) {
                const changes = [];
                
                if (oldPeriod.schoolId !== newPeriod.schoolId) {
                    const oldSchoolName = this.getSchoolName(oldPeriod.schoolId);
                    const newSchoolName = this.getSchoolName(newPeriod.schoolId);
                    changes.push({
                        label: 'Escuela',
                        from: oldSchoolName,
                        to: newSchoolName
                    });
                }

                if (oldPeriod.year !== newPeriod.year) {
                    changes.push({
                        label: 'Año',
                        from: oldPeriod.year,
                        to: newPeriod.year
                    });
                }

                if (oldPeriod.periodType !== newPeriod.periodType) {
                    const oldType = oldPeriod.periodType === 'semester' ? 'Semestres' : 'Trimestres';
                    const newType = newPeriod.periodType === 'semester' ? 'Semestres' : 'Trimestres';
                    changes.push({
                        label: 'Tipo',
                        from: oldType,
                        to: newType
                    });
                }

                if (oldPeriod.periodNumber !== newPeriod.periodNumber) {
                    const oldNumber = this.getPeriodName(oldPeriod.periodType, oldPeriod.periodNumber);
                    const newNumber = this.getPeriodName(newPeriod.periodType, newPeriod.periodNumber);
                    changes.push({
                        label: 'Período',
                        from: oldNumber,
                        to: newNumber
                    });
                }

                if (changes.length === 0) return null;

                return changes.map(change => `
                    <div class="detail-item">
                        <span class="detail-label">${change.label}:</span>
                        <div class="detail-change">
                            <span>${change.from}</span>
                            <i class="fas fa-arrow-right" style="color: #667eea; font-size: 12px;"></i>
                            <span>${change.to}</span>
                        </div>
                    </div>
                `).join('');
            }

            getSchoolName(schoolId) {
                const schoolSelector = document.getElementById('schoolSelector');
                if (schoolSelector) {
                    const option = schoolSelector.querySelector(`option[value="${schoolId}"]`);
                    return option ? option.textContent : 'Escuela desconocida';
                }
                return 'Mi Escuela';
            }

            getPeriodName(periodType, periodNumber) {
                if (periodType === 'semester') {
                    return periodNumber === 1 ? 'Primer Semestre' : 'Segundo Semestre';
                } else {
                    return periodNumber === 1 ? 'Primer Trimestre' : 
                           periodNumber === 2 ? 'Segundo Trimestre' : 'Tercer Trimestre';
                }
            }

            getChangeMessage(oldPeriod, newPeriod) {
                if (oldPeriod.schoolId !== newPeriod.schoolId) {
                    return 'Cambiando de escuela y actualizando período académico...';
                }
                if (oldPeriod.year !== newPeriod.year) {
                    return 'Cambiando de año académico...';
                }
                if (oldPeriod.periodType !== newPeriod.periodType) {
                    return 'Cambiando tipo de período académico...';
                }
                if (oldPeriod.periodNumber !== newPeriod.periodNumber) {
                    return 'Cambiando de período...';
                }
                return 'Actualizando período académico...';
            }

            getSuccessMessage(oldPeriod, newPeriod) {
                if (oldPeriod.schoolId !== newPeriod.schoolId) {
                    return '¡Escuela y período cambiados exitosamente!';
                }
                if (oldPeriod.year !== newPeriod.year) {
                    return '¡Año académico cambiado exitosamente!';
                }
                if (oldPeriod.periodType !== newPeriod.periodType) {
                    return '¡Tipo de período cambiado exitosamente!';
                }
                if (oldPeriod.periodNumber !== newPeriod.periodNumber) {
                    return '¡Período académico cambiado exitosamente!';
                }
                return '¡Período académico actualizado!';
            }
        }

        // Inicializar sistema de notificaciones
        let notificationSystem;

        // Cargar y verificar sesión al cargar la página
        document.addEventListener('DOMContentLoaded', async function() {
            // Cargar tema guardado
            loadSavedTheme();
            
            // Inicializar sistema de notificaciones
            if (!window.notificationSystem) {
                window.notificationSystem = new NotificationSystem();
                notificationSystem = window.notificationSystem;
            }
            
            const fadeElements = document.querySelectorAll('.fade-in');

            if (!sessionStorage.getItem('firstDashboardLoad')) {
                fadeElements.forEach((element, index) => {
                    element.style.animationDelay = `${index * 0.1}s`;
                });
                sessionStorage.setItem('firstDashboardLoad', 'true');
            } else {
                fadeElements.forEach(element => element.classList.remove('fade-in'));
            }

            const sessionInfo = await checkUserSession();
            if (sessionInfo) {
                setupUserInterface(sessionInfo.type, sessionInfo.user);
                if (sessionInfo.type === 'admin') {
                    loadAdminStats();
                } else if (sessionInfo.type === 'teacher') {
                    loadTeacherStats();
                    
                    window.addEventListener('academicPeriodChanged', () => {
                        loadTeacherStats();
                        loadIntegratedTeacherProfile();
                    });
                    window.addEventListener('reloadPeriodData', () => {
                        loadTeacherStats();
                        loadIntegratedTeacherProfile();
                    });
                }
            }
        });
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
            
            console.log(`🎨 Tema cambiado a: ${newTheme}`);
        }

        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            console.log(`🎨 Tema cargado: ${savedTheme}`);
        }

        function updateThemeIcon(theme) {
            const themeIcon = document.getElementById('themeIcon');
            const themeBtn = document.getElementById('themeToggleBtn');
            
            if (themeIcon && themeBtn) {
                if (theme === 'dark') {
                    themeIcon.className = 'fas fa-sun';
                    themeBtn.title = 'Cambiar a tema claro';
                } else {
                    themeIcon.className = 'fas fa-moon';
                    themeBtn.title = 'Cambiar a tema oscuro';
                }
            }
        }

        // Configurar interfaz según tipo de usuario
        function setupUserInterface(userType, userData) {
            if (!userType) {
                console.log('⚠️ No se encontró tipo de usuario válido');
                return;
            }

            // Mostrar información del usuario en el header
            const userSection = document.getElementById('userSection');
            const userNameEl = document.getElementById('currentUserName');
            const userRoleEl = document.getElementById('currentUserRole');

            if (userSection && userNameEl && userRoleEl) {
                userSection.style.display = 'flex';
                
                if (userType === 'admin') {
                    userNameEl.textContent = userData || 'Administrador';
                    userRoleEl.textContent = 'Administrador del Sistema';
                    
                    // Mostrar elementos admin
                    document.querySelectorAll('.admin-only').forEach(element => {
                        element.style.display = 'block';
                    });
                    
                } else if (userType === 'teacher') {
                    const teacherName = userData.name || userData.full_name || 'Profesor';
                    userNameEl.textContent = teacherName;
                    userRoleEl.textContent = 'Docente';
                    
                    // Mostrar elementos profesor
                    document.querySelectorAll('.teacher-only').forEach(element => {
                        element.style.display = 'block';
                    });
                    
                    // Cargar perfil unificado
                    setTimeout(() => {
                        loadIntegratedTeacherProfile();
                    }, 100);
                }
            }
            
            console.log(`✅ Interfaz configurada para ${userType}`);
        }

        // Verificar sesión (Admin O Profesor)
        async function checkUserSession() {
            console.log('🔍 Verificando sesión de usuario...');
            
            // Primero verificar si es admin
            const adminSession = sessionStorage.getItem('adminSession');
            const adminUser = sessionStorage.getItem('adminUser');

            if (adminSession === 'true' && adminUser) {
                console.log('✅ Sesión de administrador válida encontrada');
                return { type: 'admin', user: adminUser };
            }
            
            // Si no es admin, verificar profesor
            const teacherSession = sessionStorage.getItem('teacherSession');
            let teacherData = sessionStorage.getItem('teacherData');

            if (teacherSession === 'true') {
                if (!teacherData) {
                    const storedInfo = localStorage.getItem('teacherInfo');
                    if (storedInfo) {
                        teacherData = storedInfo;
                        sessionStorage.setItem('teacherData', storedInfo);
                    } else {
                        try {
                            const response = await authenticatedFetch('/api/teachers/current');
                            const result = await response.json();
                            if (result.success) {
                                teacherData = JSON.stringify({
                                    id: result.data.id,
                                    name: result.data.full_name,
                                    email: result.data.email,
                                    school: result.data.school_name,
                                    cedula: result.data.cedula
                                });
                                sessionStorage.setItem('teacherData', teacherData);
                                localStorage.setItem('teacherInfo', teacherData);
                            }
                        } catch (fetchError) {
                            console.error('Error recuperando datos del profesor:', fetchError);
                        }
                    }
                }

                if (teacherData) {
                    try {
                        const teacher = JSON.parse(teacherData);
                        console.log('✅ Sesión de profesor válida encontrada');
                        return { type: 'teacher', user: teacher };
                    } catch (error) {
                        console.error('Error parseando datos del profesor:', error);
                    }
                }
            }
            
            console.log('⚠️ No se encontró sesión válida, verificando en 2 segundos...');
            
            setTimeout(() => {
                const adminSessionCheck = sessionStorage.getItem('adminSession');
                const teacherSessionCheck = sessionStorage.getItem('teacherSession');
                
                if (!adminSessionCheck && !teacherSessionCheck) {
                    console.log('🚫 Definitivamente no hay sesión válida, redirigiendo...');
                    alert('🚫 Debes iniciar sesión para acceder al dashboard.');
                    window.location.href = 'login.html';
                } else {
                    console.log('✅ Sesión encontrada en segunda verificación, recargar interfaz');
                    window.location.reload();
                }
            }, 2000);
            
            return null;
        }

        // Cargar estadísticas - Solo para admin
        async function loadAdminStats() {
            try {
                console.log('📊 Cargando estadísticas de administrador...');
                
                if (document.getElementById('professorsCount')) {
                    document.getElementById('professorsCount').textContent = '0';
                }
                if (document.getElementById('studentsCount')) {
                    document.getElementById('studentsCount').textContent = '0';
                }
                if (document.getElementById('schoolsCount')) {
                    document.getElementById('schoolsCount').textContent = '0';
                }
                
                console.log('✅ Estadísticas de administrador cargadas');
            } catch (error) {
                console.error('⚠️ Error cargando estadísticas de admin:', error);
            }
        }

        // Cargar estadísticas para profesor
        async function loadTeacherStats() {
            try {
                const teacherData = JSON.parse(sessionStorage.getItem('teacherData'));
                
                // Calcular tiempo activo
                const now = new Date();
                const currentYear = now.getFullYear();
                document.getElementById('teacherSince').textContent = currentYear;
                
                // Cargar número de estudiantes del período actual
                document.getElementById('teacherStudentsCount').textContent = '⏳';

                const period = window.getCurrentAcademicPeriod ? window.getCurrentAcademicPeriod() : null;
                let query = '';
                if (period) {
                    query = `?year=${period.year}&period_type=${period.periodType}&period_number=${period.periodNumber}`;
                }

                const studentsResponse = await authenticatedFetch(`/api/students${query}`);
                if (studentsResponse.ok) {
                    const studentsResult = await studentsResponse.json();
                    if (studentsResult.success) {
                        document.getElementById('teacherStudentsCount').textContent = studentsResult.data.length;
                    }
                }
                
            } catch (error) {
                console.error('Error cargando estadísticas del profesor:', error);
                document.getElementById('teacherStudentsCount').textContent = '0';
            }
        }

        // Cargar perfil integrado del profesor
        function loadIntegratedTeacherProfile() {
            const teacherData = sessionStorage.getItem('teacherData');
            if (teacherData) {
                const teacher = JSON.parse(teacherData);
                
                // Información básica en el header
                document.getElementById('teacherProfileName').textContent = teacher.name || 'Sin nombre';
                document.getElementById('teacherProfileSchool').textContent = teacher.school || teacher.school_name || 'Sin escuela';
                
                // Actualizar selector de escuelas
                const schoolSelector = document.getElementById('schoolSelector');
                if (schoolSelector) {
                    schoolSelector.innerHTML = '';

                    const savedPeriodRaw = localStorage.getItem(getPeriodStorageKey());
                    let savedSchoolId = null;
                    if (savedPeriodRaw) {
                        try {
                            const savedPeriod = JSON.parse(savedPeriodRaw);
                            savedSchoolId = savedPeriod.schoolId || null;
                        } catch (err) {
                            console.warn('Error parseando período guardado:', err);
                        }
                    }

                    if (teacher.schools && Array.isArray(teacher.schools) && teacher.schools.length > 0) {
                        teacher.schools.forEach((s, idx) => {
                            const option = document.createElement('option');
                            option.value = s.school_id;
                            option.textContent = s.school_name;
                            schoolSelector.appendChild(option);
                        });

                        if (savedSchoolId) {
                            schoolSelector.value = savedSchoolId;
                        } else {
                            const primary = teacher.schools.find(s => s.is_primary_school === 1) || teacher.schools[0];
                            if (primary) {
                                schoolSelector.value = primary.school_id;
                            }
                        }
                    } else {
                        const option = document.createElement('option');
                        option.value = 'teacher_school';
                        option.textContent = teacher.school || teacher.school_name || 'Mi Escuela';
                        schoolSelector.appendChild(option);
                        schoolSelector.value = option.value;
                    }
                }
                
                // Información en las tarjetas
                document.getElementById('teacherCedula').textContent = teacher.cedula || 'No especificado';
                document.getElementById('teacherEmail').textContent = teacher.email || 'No especificado';
                document.getElementById('teacherType').textContent = teacher.teacher_type || 'No especificado';
                document.getElementById('teacherRegional').textContent = teacher.regional || 'No especificado';
                
                // Llenar campos de edición
                document.getElementById('quickEditName').value = teacher.name || '';
                document.getElementById('quickEditSchool').value = teacher.school || teacher.school_name || '';
                
                // Actualizar período actual
                updateCurrentPeriodDisplay();
                
                console.log('✅ Perfil unificado cargado exitosamente');
            }
        }

        // Funciones de los paneles expandibles (mejoradas sin parpadeo)
        function togglePeriodSelector() {
            const panel = document.getElementById('periodSelectorPanel');
            const btn = document.getElementById('periodSelectorBtn');
            
            if (!panel.classList.contains('show')) {
                // Mostrar panel con animación suave
                panel.style.display = 'block';
                // Pequeño delay para que el display: block tome efecto antes de la animación
                setTimeout(() => {
                    panel.classList.add('show');
                    panel.classList.remove('hide');
                }, 10);
                
                btn.innerHTML = '<i class="fas fa-calendar-times"></i> Ocultar Período';
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            } else {
                // Ocultar panel con animación suave
                panel.classList.remove('show');
                panel.classList.add('hide');
                
                // Esperar a que termine la animación antes de ocultar
                setTimeout(() => {
                    panel.style.display = 'none';
                    panel.classList.remove('hide');
                }, 400);
                
                btn.innerHTML = '<i class="fas fa-calendar-alt"></i> Período Académico';
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-primary');
            }
        }

        // Función específica para cerrar el panel automáticamente (sin toggle)
        function closePeriodSelector() {
            const panel = document.getElementById('periodSelectorPanel');
            const btn = document.getElementById('periodSelectorBtn');
            
            // Solo cerrar si está abierto
            if (panel.classList.contains('show')) {
                panel.classList.remove('show');
                panel.classList.add('hide');
                
                setTimeout(() => {
                    panel.style.display = 'none';
                    panel.classList.remove('hide');
                }, 400);
                
                // Resetear botón al estado original
                btn.innerHTML = '<i class="fas fa-calendar-alt"></i> Período Académico';
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-primary');
            }
        }

        function toggleQuickEdit() {
            const panel = document.getElementById('quickEditPanel');
            const btn = document.getElementById('quickEditBtn');
            
            if (!panel.classList.contains('show')) {
                // Mostrar panel con animación suave
                panel.style.display = 'block';
                setTimeout(() => {
                    panel.classList.add('show');
                    panel.classList.remove('hide');
                }, 10);
                
                btn.innerHTML = '<i class="fas fa-eye"></i> Ver Perfil';
            } else {
                // Ocultar panel con animación suave
                panel.classList.remove('show');
                panel.classList.add('hide');
                
                setTimeout(() => {
                    panel.style.display = 'none';
                    panel.classList.remove('hide');
                }, 400);
                
                btn.innerHTML = '<i class="fas fa-edit"></i> Editar Perfil';
            }
        }

        async function saveQuickEdit() {
            const teacherData = JSON.parse(sessionStorage.getItem('teacherData'));
            
            const updatedData = {
                name: document.getElementById('quickEditName').value.trim(),
                school_name: document.getElementById('quickEditSchool').value.trim()
            };
            
            if (!updatedData.name || !updatedData.school_name) {
                alert('❌ El nombre y la escuela son obligatorios');
                return;
            }
            
            try {
                const response = await fetch(`/api/teachers/${teacherData.id}/profile`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    teacherData.name = updatedData.name;
                    teacherData.school = updatedData.school_name;
                    sessionStorage.setItem('teacherData', JSON.stringify(teacherData));
                    
                    loadIntegratedTeacherProfile();
                    loadTeacherStats();
                    setupUserInterface('teacher', teacherData);
                    toggleQuickEdit();
                    
                    alert('✅ Perfil actualizado exitosamente');
                } else {
                    alert('❌ Error: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('❌ Error de conexión. Intenta nuevamente.');
            }
        }

        function cancelQuickEdit() {
            loadIntegratedTeacherProfile();
            toggleQuickEdit();
        }

        function updateCurrentPeriodDisplay() {
            const currentPeriod = getCurrentAcademicPeriod();
            const indicator = document.getElementById('currentPeriodText');
            const schoolLabel = document.getElementById('teacherProfileSchool');
            const schoolSelector = document.getElementById('schoolSelector');

            if (indicator && currentPeriod) {
                const periodTypeName = currentPeriod.periodType === 'semester' ? 'Semestre' : 'Trimestre';
                const periodNumber = currentPeriod.periodNumber === 1 ? 'Primer' :
                                    currentPeriod.periodNumber === 2 ? 'Segundo' : 'Tercer';
                if (schoolLabel && schoolSelector) {
                    const option = schoolSelector.querySelector(`option[value="${currentPeriod.schoolId}"]`);
                    if (option) {
                        schoolLabel.textContent = option.textContent;
                    }
                }

                indicator.textContent = `${currentPeriod.year} - ${periodNumber} ${periodTypeName}`;
            }
        }

        // Logout unificado
        function logoutUser() {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                sessionStorage.removeItem('teacherSession');
                sessionStorage.removeItem('teacherData');
                sessionStorage.removeItem('adminSession');
                sessionStorage.removeItem('adminUser');
                localStorage.removeItem('sessionToken');
                localStorage.removeItem('adminToken');

                window.location.href = 'login.html';
            }
        }

        // Navegación de módulos
        function openModule(moduleName) {
            if (moduleName === 'admin') {
                const adminSession = sessionStorage.getItem('adminSession');
                if (adminSession === 'true') {
                    window.location.href = 'admin.html';
                } else {
                    alert('🚫 Solo el administrador puede acceder a este módulo.\n\nUsa las credenciales especiales en el login principal.');
                    return;
                }
            }
            
            const moduleRoutes = {
                'estudiantes': 'students.html',
                'asistencia': 'attendance.html',
                'cotidiano': 'cotidiano.html',
                'evaluaciones': 'evaluations.html',
                'materias': 'subjects.html',
                'reportes': 'reportes.html',
                'sea': 'sea.html'
            };
            
            if (moduleRoutes[moduleName]) {
                window.location.href = moduleRoutes[moduleName];
            } else {
                alert(`📝 El módulo "${moduleName}" está en desarrollo.\n\n¡Próximamente estará disponible!`);
            }
        }

        // SISTEMA DE PERÍODOS ACADÉMICOS
        function getPeriodStorageKey() {
            const data = sessionStorage.getItem('teacherData');
            if (data) {
                try {
                    const teacher = JSON.parse(data);
                    if (teacher.id) {
                        return `currentAcademicPeriod_${teacher.id}`;
                    }
                } catch (err) {
                    console.warn('Error parseando teacherData:', err);
                }
            }
            return 'currentAcademicPeriod';
        }

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar sistema de notificaciones si no existe
            if (!notificationSystem) {
                notificationSystem = new NotificationSystem();
            }
            
            // Cerrar modal al hacer click en el overlay
            const overlay = document.getElementById('notificationOverlay');
            if (overlay) {
                overlay.addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        notificationSystem.hideModal();
                    }
                });
            }
            
            // IMPORTANTE: Usar inicializador del global-period-selector.js PERO mantener las notificaciones
            if (typeof window.initGlobalPeriodSelector === 'function') {
                // Hook el sistema de notificaciones en el selector global
                const originalPeriodSelector = window.unifiedPeriodSelector;
                window.initGlobalPeriodSelector();
                
                // Si el global-period-selector tiene applyPeriodChange, lo sobrescribimos para incluir las notificaciones
                if (window.globalPeriodSelector && window.globalPeriodSelector.applyPeriodChange) {
                    const originalApply = window.globalPeriodSelector.applyPeriodChange.bind(window.globalPeriodSelector);
                    
                    window.globalPeriodSelector.applyPeriodChange = async function() {
                        const schoolSelector = document.getElementById('schoolSelector');
                        const yearSelector = document.getElementById('yearSelector');
                        const periodTypeSelector = document.getElementById('periodTypeSelector');
                        const periodSelector = document.getElementById('periodSelector');

                        if (!schoolSelector || !yearSelector || !periodTypeSelector || !periodSelector) {
                            console.error('No se encontraron todos los selectores necesarios');
                            return;
                        }

                        const oldPeriod = { ...this.currentPeriod };
                        const newPeriod = {
                            schoolId: schoolSelector.value,
                            year: parseInt(yearSelector.value),
                            periodType: periodTypeSelector.value,
                            periodNumber: parseInt(periodSelector.value)
                        };

                        // Verificar si realmente hay cambios
                        const hasChanges = JSON.stringify(oldPeriod) !== JSON.stringify(newPeriod);
                        if (!hasChanges) {
                            notificationSystem.showToast('info', 'Sin cambios', 'El período seleccionado ya está activo');
                            return;
                        }

                        console.log('📅 Aplicando período con notificaciones:', newPeriod);

                        try {
                            // Generar detalles de cambios
                            const changeDetails = notificationSystem.generateChangeDetails(oldPeriod, newPeriod);
                            const loadingMessage = notificationSystem.getChangeMessage(oldPeriod, newPeriod);
                            
                            // Mostrar modal de carga
                            notificationSystem.showModal(
                                'loading', 
                                'Cambiando Período', 
                                loadingMessage,
                                changeDetails
                            );

                            // Deshabilitar botón durante el proceso
                            const applyBtn = document.getElementById('applyPeriodBtn');
                            if (applyBtn) {
                                applyBtn.disabled = true;
                                applyBtn.innerHTML = '<div class="spinner" style="width: 16px; height: 16px; border-width: 2px; margin: 0;"></div> Aplicando...';
                            }

                            // Simular delay para mejor UX
                            await new Promise(resolve => setTimeout(resolve, 1500));

                            // Llamar al método original
                            await originalApply();
                            
                            // Mostrar éxito en modal
                            const successMessage = notificationSystem.getSuccessMessage(oldPeriod, newPeriod);
                            notificationSystem.showModal(
                                'success',
                                '¡Período Cambiado!',
                                successMessage,
                                changeDetails
                            );

                            // Resetear botón
                            if (applyBtn) {
                                applyBtn.disabled = false;
                                applyBtn.style.background = '#10b981';
                                applyBtn.innerHTML = '<i class="fas fa-check"></i> ¡Aplicado!';
                            }

                            // Auto-cerrar modal después de 2 segundos
                            setTimeout(() => {
                                notificationSystem.hideModal();
                                
                                // Ocultar panel de período después de completar (SIN toast para evitar duplicados)
                                setTimeout(() => {
                                    closePeriodSelector(); // Usar función específica para cerrar automáticamente
                                    
                                    // Resetear botón después de cerrar panel
                                    if (applyBtn) {
                                        applyBtn.innerHTML = '<i class="fas fa-check"></i> Aplicar Período';
                                        applyBtn.style.background = '#667eea';
                                    }
                                }, 1000);
                                
                            }, 2000);

                            console.log('✅ Período académico actualizado exitosamente con notificaciones:', newPeriod);
                            
                        } catch (error) {
                            console.error('❌ Error aplicando período:', error);
                            
                            // Mostrar error en modal
                            notificationSystem.showModal(
                                'error',
                                'Error al Cambiar Período',
                                'No se pudo aplicar el cambio. Por favor, inténtalo nuevamente.',
                                `<div class="detail-item"><span class="detail-label">Error:</span><span class="detail-value" style="color: #ef4444;">${error.message}</span></div>`
                            );

                            // Resetear botón
                            const applyBtn = document.getElementById('applyPeriodBtn');
                            if (applyBtn) {
                                applyBtn.disabled = false;
                                applyBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Reintentar';
                                applyBtn.style.background = '#ef4444';
                            }

                            // Auto-cerrar modal de error después de 3 segundos
                            setTimeout(() => {
                                notificationSystem.hideModal();
                                
                                // Mostrar toast de error
                                notificationSystem.showToast(
                                    'error',
                                    'Error al cambiar período',
                                    'Verifica tu conexión e inténtalo nuevamente'
                                );
                                
                                // Resetear botón
                                setTimeout(() => {
                                    if (applyBtn) {
                                        applyBtn.innerHTML = '<i class="fas fa-check"></i> Aplicar Período';
                                        applyBtn.style.background = '#667eea';
                                    }
                                }, 2000);
                                
                            }, 3000);
                        }
                    };
                }
            } else {
                console.log('⚠️ global-period-selector.js no encontrado, usando funcionalidad local');
            }
            
            window.addEventListener('academicPeriodChanged', updateCurrentPeriodDisplay);
        });

        // Función global para obtener período actual
        window.getCurrentAcademicPeriod = () => {
            return window.globalPeriodSelector ? 
                window.globalPeriodSelector.getCurrentPeriod() :
                JSON.parse(localStorage.getItem(getPeriodStorageKey()) || '{"schoolId":"1","year":2025,"periodType":"semester","periodNumber":1}');
        };

    </script>
</body>
</html>